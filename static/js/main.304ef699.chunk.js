(this["webpackJsonptysyacha-js"]=this["webpackJsonptysyacha-js"]||[]).push([[0],{21:function(e,t,a){e.exports=a(43)},27:function(e,t,a){},35:function(e,t){},38:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){"use strict";a.r(t);var n,r,s=a(0),l=a.n(s),c=a(12),o=a.n(c),i=a(1),u=a.n(i),d=a(4),p=a(2),m=(a(17),a(27),a(5)),h=a(6),f=a(3),y=a(7),g=a(8),b=a(10),v=a(19),E=a.n(v),I=a(20);function w(e){switch(e){case r.HEARTS:return 100;case r.DIAMONDS:return 80;case r.CLUBS:return 60;case r.SPADES:return 40}}function k(){return[r.HEARTS,r.CLUBS,r.DIAMONDS,r.SPADES]}function N(){return[n.ACE,n.TEN,n.KING,n.QUEEN,n.JACK,n.NINE]}function O(e){return e.valueOf()}function C(e){switch(e){case n.ACE:return"A";case n.KING:return"K";case n.QUEEN:return"Q";case n.JACK:return"J";case n.TEN:return"10";case n.NINE:return"9"}}!function(e){e[e.NINE=0]="NINE",e[e.JACK=2]="JACK",e[e.QUEEN=3]="QUEEN",e[e.KING=4]="KING",e[e.TEN=10]="TEN",e[e.ACE=11]="ACE"}(n||(n={})),function(e){e.HEARTS="\u2665",e.DIAMONDS="\u2666",e.CLUBS="\u2663",e.SPADES="\u2660"}(r||(r={}));var S=function(){function e(t,a){Object(m.a)(this,e),this.suit=void 0,this.value=void 0,this.suit=a,this.value=t}return Object(h.a)(e,[{key:"valueToString",value:function(){return C(this.value)}},{key:"toString",value:function(){var e=C(this.value);return O(this.suit)+e}}]),e}();function x(e){return new S(e.value,e.suit).toString()}var j,P=function(){function e(t){Object(m.a)(this,e),this.cards=void 0,this.cardsBySuit=void 0,this.marriages=void 0,this.cards=t,this.cardsBySuit=this._sortCardsBySuit(t),this.marriages=this._findMarriages()}return Object(h.a)(e,[{key:"findCard",value:function(e){for(var t=0;t<this.cards.length;t++){var a=this.cards[t];if(a.suit===e.suit&&a.value===e.value)return t}return-1}},{key:"hasCard",value:function(e){return-1!==this.findCard(e)}},{key:"_sortCardsBySuit",value:function(e){var t,a={},n=Object(b.a)(k());try{for(n.s();!(t=n.n()).done;){var r=t.value;a[r]=[]}}catch(c){n.e(c)}finally{n.f()}e.forEach((function(e){a[e.suit].push(e)}));for(var s=0,l=Object.values(a);s<l.length;s++){l[s].sort((function(e,t){return t.value-e.value}))}return a}},{key:"_findMarriages",value:function(){for(var e=[],t=0,a=Object.entries(this.cardsBySuit);t<a.length;t++){var n=Object(p.a)(a[t],2),r=n[0],s=n[1].map((function(e){return e.valueToString()}));s.includes("Q")&&s.includes("K")&&e.push(r)}return e}},{key:"getPoints",value:function(){for(var e=0,t=0,a=Object.values(this.cardsBySuit);t<a.length;t++){e+=a[t].reduce((function(e,t){return e+t.value}),0)}return e}}]),e}(),T=function(){function e(t){Object(m.a)(this,e),this.randomSeed=void 0,this.cards=void 0,this.randomSeed=t,this.cards=[];var a,n=Object(b.a)(k());try{for(n.s();!(a=n.n()).done;){var r,s=a.value,l=Object(b.a)(N());try{for(l.s();!(r=l.n()).done;){var c=r.value;this.cards.push(new S(c,s))}}catch(o){l.e(o)}finally{l.f()}}}catch(o){n.e(o)}finally{n.f()}E()(t.toString(),{global:!0}),console.assert(this.cards.length>0,"Cards must not be an empty array"),this.cards=I.shuffle(this.cards),console.assert(this.cards.length>0,"Cards must not be an empty array")}return Object(h.a)(e,[{key:"pop",value:function(){var e=this.cards.pop();if("undefined"===typeof e)throw new Error("Deck is empty");return e}}]),e}(),D="a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447";if("undefined"===typeof A&&"1"!==Object({NODE_ENV:"production",PUBLIC_URL:"/tysyacha-js",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).IS_SERVER)var A=a(37);!function(e){e.JOIN_LOUNGE="join-lounge",e.LEAVE_LOUNGE="leave-lounge",e.LOUNGE_USERS="lounge-users",e.GAME_SEEDS="game-seeds",e.GAME_SEED="game-seed",e.JOIN_GAME="join-game",e.LEAVE_GAME="leave-game",e.GAME_USERS="game-users",e.BROADCAST_DEAL="game-deal",e.PLAYER_CARDS="player-cards",e.BROADCAST_BID="broadcast-bid",e.BROADCAST_FINAL_CONTRACT="broadcast-final-contract",e.BROADCAST_DISTRIBUTE_CARDS="broadcast-distribute-cards",e.BROADCAST_PLAY_CARD="broadcast-play-card"}(j||(j={}));var R,G=function(){function e(){Object(m.a)(this,e),this.socket=void 0,this.socket=new WebSocket("ws://localhost:8081")}return Object(h.a)(e,[{key:"getJSON",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n){var r,s,l,c,o,i,d,m,h,f,y,g;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=new URL("http://localhost:8080")).pathname=t,a)for(s=0,l=Object.entries(a);s<l.length;s++)c=Object(p.a)(l[s],2),o=c[0],i=c[1],r.searchParams.append(o,i);if(d={"Content-Type":"application/json"},n)for(m=0,h=Object.entries(n);m<h.length;m++)f=Object(p.a)(h[m],2),y=f[0],g=f[1],d[y]=g;return e.abrupt("return",A(r.toString(),{headers:d,method:"GET",mode:"cors"}));case 6:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"postJSON",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n){var r,s,l,c,o,i,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a||(a={}),(r=new URL("http://localhost:8080")).pathname=t,s={"Content-Type":"application/json"},n)for(l=0,c=Object.entries(n);l<c.length;l++)o=Object(p.a)(c[l],2),i=o[0],d=o[1],s[i]=d;return e.abrupt("return",A(r.toString(),{body:JSON.stringify(a),headers:s,method:"POST",mode:"cors"}));case 6:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getGameUsers",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/game/".concat(t,"/users"));case 2:if(!(a=e.sent).ok){e.next=10;break}return e.next=6,a.json();case 6:return n=e.sent,e.abrupt("return",n);case 10:return console.error(a),e.t0=Error,e.next=14,a.text();case 14:throw e.t1=e.sent,new e.t0(e.t1);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPlayerCards",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n){var r,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/game/".concat(t,"/round/").concat(a,"/cards"),{username:n});case 2:if(!(r=e.sent).ok){e.next=10;break}return e.next=6,r.json();case 6:return s=e.sent,e.abrupt("return",s);case 10:return console.error(r),e.t0=Error,e.next=14,r.text();case 14:throw e.t1=e.sent,new e.t0(e.t1);case 16:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"postDealCards",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postJSON("/game/".concat(t,"/round/").concat(a,"/deal"),{username:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"joinGame",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postJSON("game/".concat(t,"/join"),{username:a});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getGameRoundInfo",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/game/".concat(t,"/round/").concat(a));case 2:if(!(n=e.sent).ok){e.next=10;break}return e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",r);case 10:console.error("failed to get info for game ".concat(t," round ").concat(a));case 11:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getBids",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/game/".concat(t,"/round/").concat(a,"/bids"));case 2:if(!(n=e.sent).ok){e.next=10;break}return e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",r);case 10:throw new Error("failed to get bids for game ".concat(t," round ").concat(a));case 11:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"postBid",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n,r){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postJSON("/game/".concat(t,"/round/").concat(a,"/bid"),{username:n,points:r});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"getTreasure",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/game/".concat(t,"/round/").concat(a,"/treasure"));case 2:if(!(n=e.sent).ok){e.next=10;break}return e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",r.map((function(e){return new S(e.value,e.suit)})));case 10:throw new Error("failed to get treasure for game ".concat(t));case 11:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"postFinalContract",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n,r){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postJSON("/game/".concat(t,"/round/").concat(a,"/final-contract"),{username:n,points:r});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"postDistributeCards",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n,r,s){var l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postJSON("/game/".concat(t,"/round/").concat(a,"/distribute-cards"),{username:n,distributedCards:r,keptCards:s});case 2:return l=e.sent,e.abrupt("return",l);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()},{key:"postPlayCard",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n,r,s){var l,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postJSON("/game/".concat(t,"/round/").concat(a,"/play-card"),{username:n,card:r,isMarriage:s});case 2:if(!(l=e.sent).ok){e.next=7;break}return e.abrupt("return",l);case 7:return e.next=9,l.text();case 9:throw c=e.sent,new Error("failed to play card: ".concat(c));case 11:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()},{key:"getPlayingPhaseInfo",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/game/".concat(t,"/round/").concat(a,"/playing-phase-info"));case 2:if(!(n=e.sent).ok){e.next=13;break}return e.next=6,n.json();case 6:if(r=e.sent){e.next=9;break}throw new Error("no playing phase info loaded");case 9:return r.currentTrick=r.currentTrick.map((function(e){return{player:e.player,card:new S(e.card.value,e.card.suit)}})),e.abrupt("return",r);case 13:throw new Error("failed to get playing phase info for game ".concat(t));case 14:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"joinLounge",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postJSON("/lounge/join",{username:t,isHeartbeat:a});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"leaveLounge",value:function(e){this.socket.send(JSON.stringify({msgType:j.LEAVE_LOUNGE,username:e}))}},{key:"createGame",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r,s,l,c,o,i,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={username:t},a)for(r=0,s=Object.entries(a);r<s.length;r++)l=Object(p.a)(s[r],2),c=l[0],o=l[1],n[c]=o;return e.next=4,this.postJSON("/game/new",n);case 4:return i=e.sent,e.next=7,i.json();case 7:return d=e.sent,e.abrupt("return",d);case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getGameInfo",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/game/".concat(a),{username:t});case 2:if(!(n=e.sent).ok){e.next=10;break}return e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",r);case 10:return console.error(n),e.t0=Error,e.next=14,n.text();case 14:throw e.t1=e.sent,new e.t0(e.t1);case 16:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"postEndRound",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postJSON("/game/".concat(t,"/round/").concat(a,"/end-round"),{username:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"adminGetGames",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/admin",{},{Authorization:"Bearer ".concat(D)});case 2:if(!(t=e.sent).ok){e.next=10;break}return e.next=6,t.json();case 6:return a=e.sent,e.abrupt("return",a);case 10:return console.error(t),e.t0=Error,e.next=14,t.text();case 14:throw e.t1=e.sent,new e.t0(e.t1);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"adminGetGameInfo",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJSON("/admin/game/".concat(t),{},{Authorization:"Bearer ".concat(D)});case 2:if(!(a=e.sent).ok){e.next=12;break}return e.next=6,a.json();case 6:return n=e.sent,Object.keys(n.cardsPerRound).map((function(e){return Number.parseInt(e,10)})).forEach((function(e){var t={};Object.keys(n.cardsPerRound[e].playerCards).forEach((function(a){var r=n.cardsPerRound[e].playerCards[a].cards.map((function(e){return new S(e.value,e.suit)}));t[a]=new P(r)}));var a=n.cardsPerRound[e].treasure.map((function(e){return new S(e.value,e.suit)}));n.cardsPerRound[e].treasure=a,n.cardsPerRound[e].playerCards=t})),e.abrupt("return",n);case 12:return console.error(a),e.t0=Error,e.next=16,a.text();case 16:throw e.t1=e.sent,new e.t0(e.t1);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},Object.assign(n,a),n.msgType=t,e.next=5,this.socket.send(JSON.stringify(n));case 5:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"addMessageListener",value:function(e,t){this.socket.addEventListener("message",(function(a){var n=JSON.parse(a.data);e.includes(n.msgType)&&t(n)}))}}]),e}(),B=G,L=a(9);!function(e){e[e.NOT_DEALT=0]="NOT_DEALT",e[e.BIDDING=1]="BIDDING",e[e.REVEAL_TREASURE=2]="REVEAL_TREASURE",e[e.DISTRIBUTE_CARDS=3]="DISTRIBUTE_CARDS",e[e.PLAYING=4]="PLAYING",e[e.SCORING=5]="SCORING"}(R||(R={}));function _(e,t,a,r){return!!r&&(!(e.value!==n.QUEEN&&e.value!==n.KING||!t.marriages.includes(e.suit))&&a>0)}function H(e,t){if(0===e.length)throw new Error("current trick may not be empty");var a,n=e[0].player,r=e[0].card,s=Object(b.a)(e);try{for(s.s();!(a=s.n()).done;){var l=a.value;(t&&l.card.suit===t?r.suit!==t||l.card.value>r.value:l.card.suit===e[0].card.suit&&((!t||r.suit!==t)&&l.card.value>r.value))&&(r=l.card,n=l.player)}}catch(c){s.e(c)}finally{s.f()}return{player:n,card:r}}function U(e,t){if(3!==e.length)throw new Error("There must only be 3 cards in the current trick, found ".concat(e.length));return H(e,t)}function M(e){var t,a=0,n=null,r=Object(b.a)(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;s.points>a&&(a=s.points,n=s.player)}}catch(l){r.e(l)}finally{r.f()}return n?{player:n,points:a}:null}function F(e){for(var t=[],a=e.cards.getPoints(),n=0,r=Object.entries(e.cards.cardsBySuit);n<r.length;n++){var l=Object(p.a)(r[n],2),c=l[0],o=l[1].map((function(e){return e.valueToString()})).join(", ");t.push(s.createElement("div",{key:"suit-".concat(c,"-player-").concat(e.index,"-cards")},s.createElement("span",{className:"player-cards-suit"},O(c)),o))}for(var i=e.cards.marriages,u=[],d=0,m=Object.entries(e.cards.cardsBySuit);d<m.length;d++){var h=Object(p.a)(m[d],2),f=h[0],y=h[1];if(!i.includes(f)){var g=y.map((function(e){return e.valueToString()}));(g.includes("Q")||g.includes("K"))&&u.push(f)}}return s.createElement("div",{className:"player"},t,e.phase!==R.PLAYING?s.createElement("div",null,"Points: ",a):null,s.createElement("div",{className:"marriages"},s.createElement("span",null,"Marriages: "),i.length>0?i.join(", "):"none"),e.phase===R.BIDDING?s.createElement("div",{className:"potential-marriages"},s.createElement("span",null,"Potential Marriages: "),u.length>0?u.join(", "):"none"):null)}var J=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={isCollapsed:!!n.props.isCollapsed},n.toggleCollapse=n.toggleCollapse.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"toggleCollapse",value:function(e){e.preventDefault(),this.setState({isCollapsed:!this.state.isCollapsed})}},{key:"render",value:function(){var e=this,t=M(this.props.bids),a=this.props.bids.map((function(e,t){return l.a.createElement("tr",{key:"}bid-row-".concat(t)},l.a.createElement("td",null,e.player),l.a.createElement("td",null,0===e.points?"pass":e.points))})),n=0===this.props.bids.length?l.a.createElement("div",null,"no bids yet"):l.a.createElement("table",{className:"table table-striped table-sm"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Player"),l.a.createElement("th",null,"Bid"))),l.a.createElement("tbody",null,a));return l.a.createElement("div",{className:"bid-history-container"},l.a.createElement("h2",null,l.a.createElement("a",{href:"#bid-collpase",role:"button",onClick:function(t){return e.toggleCollapse(t)}},l.a.createElement("span",null,"Bids"),l.a.createElement("span",null,this.state.isCollapsed?"(collapsed)":""))),null===t||this.state.isCollapsed?null:l.a.createElement("div",{className:"highest-bid"},"Highest bid: ",t.points,"\xa0(",t.player,")"),this.state.isCollapsed?null:n)}}]),a}(l.a.PureComponent);function Y(e){var t=Object(s.useState)([]),a=Object(p.a)(t,2),n=a[0],r=a[1],c=Object(s.useState)(-1),o=Object(p.a)(c,2),i=o[0],u=o[1],d=Object(s.useState)(!1),m=Object(p.a)(d,2),h=m[0],f=m[1],y=Object(s.useState)(null),g=Object(p.a)(y,2),b=g[0],v=g[1],E=Object(s.useState)(!1),I=Object(p.a)(E,2),w=I[0],k=I[1],N=Object(s.useState)(0),O=Object(p.a)(N,2),C=O[0],S=O[1],x=Object(s.useState)([]),P=Object(p.a)(x,2),T=P[0],D=P[1],A=Object(s.useState)(0),G=Object(p.a)(A,2),B=G[0],_=G[1];function H(t,a){t.preventDefault();var s=B;s&&s<=C&&!a?v("Your bid must be over ".concat(C)):(v(null),a&&(s=0),r([].concat(Object(L.a)(n),[{player:e.name,points:s}])),e.api.postBid(e.gameId,e.round,e.name,s))}return Object(s.useEffect)((function(){-1===i&&u((e.dealer+1)%3)}),[e.dealer,i]),Object(s.useEffect)((function(){function t(t,a,s){var l=e.playerNames.indexOf(a);if(u((l+1)%3),n.length!==t.length){r(t);var c=t.filter((function(e){return 0===e.points})).map((function(e){return e.player}));D(c)}if(t.length>0){var o=Math.max.apply(Math,Object(L.a)(t.map((function(e){return e.points}))));S(o)}else S(0);if(s!==R.BIDDING){console.log("we're done with bidding phase. next phase is ".concat(s));var i=M(n);e.onNextPhase(i)}}h||(e.api.addMessageListener([j.BROADCAST_BID],(function(a){if(a.gameId===e.gameId)return t(a.bidHistory,a.lastBidder,a.nextPhase)})),f(!0)),w||e.api.getBids(e.gameId,e.round).then((function(e){if(e.bidHistory.length>0){var a=e.bidHistory[e.bidHistory.length-1].player;t(e.bidHistory,a,e.nextPhase)}k(!0)}))}),[h,w,n,e]),l.a.createElement("div",{className:"bidding-view"},l.a.createElement("h3",null,"Bidding"),l.a.createElement("div",null,l.a.createElement("span",null,"Player bidding:\xa0"),l.a.createElement("span",null,e.playerNames[i]),i===e.playerIndex?l.a.createElement("span",null,"\xa0(you)"):null),l.a.createElement(J,{bids:n}),l.a.createElement("h3",null,"Your Cards"),l.a.createElement("div",{className:"player-cards-view"},l.a.createElement(F,{index:e.playerIndex,cards:e.playerCards,phase:R.BIDDING})),e.playerIndex===i?l.a.createElement("div",null,l.a.createElement("h4",null,"Your Bid"),b?l.a.createElement("div",{className:"alert alert-danger",role:"alert"},b):null,l.a.createElement("form",{className:"bidding-form",onSubmit:function(e){return H(e,!1)}},l.a.createElement("label",{htmlFor:"bid"},"Bid"),l.a.createElement("input",{type:"number",min:100,max:400,name:"bid",placeholder:"enter your bid here",className:"form-control",onChange:function(e){return function(e){var t=e.target.value;_(Number.parseInt(t))}(e)}}),l.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:function(e){return H(e,!0)}},"Pass"),l.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return H(e,!1)},disabled:B<=C||T.includes(e.name)},"Submit"))):null)}function V(e){var t=Object(s.useState)(e.winningBid.points),a=Object(p.a)(t,2),n=a[0],r=a[1];var c=e.treasure.map((function(e,t){return l.a.createElement("span",{key:"treasure-".concat(t)},e.toString())})),o=e.winningBid.player===e.name?l.a.createElement("div",null,l.a.createElement("h3",null,"Current Bid"),l.a.createElement("div",null,"Your winning bid was ",e.winningBid.points)):l.a.createElement("div",null,"Waiting for ",e.winningBid.player," to finalize contract..."),i=null;return e.winningBid.player===e.name&&(i=l.a.createElement("div",null,l.a.createElement("h3",null,"Final Contract"),l.a.createElement("form",{className:"bidding-form",onSubmit:function(t){return function(t){t.preventDefault(),e.onSetFinalContract(n)}(t)}},l.a.createElement("label",{htmlFor:"bid"},"Bid"),l.a.createElement("input",{type:"number",min:e.winningBid.points,max:400,name:"bid",placeholder:"enter your final contract here",className:"form-control",onChange:function(e){return function(e){r(Number.parseInt(e.target.value))}(e)},value:n}),l.a.createElement("button",{type:"submit",className:"btn btn-primary",disabled:n<e.winningBid.points},"Submit")))),l.a.createElement("div",{className:"reveal-treasure-view"},o,l.a.createElement("h3",null,"Treasure"),l.a.createElement("div",null,c),l.a.createElement("h3",null,"Your Cards"),l.a.createElement(F,{index:e.playerIndex,cards:e.hand,phase:R.REVEAL_TREASURE}),i)}var W=function(e){var t=Object(s.useState)(-1),a=Object(p.a)(t,2),n=a[0],r=a[1],c=Object(s.useState)(-1),o=Object(p.a)(c,2),i=o[0],u=o[1];if(e.name!==e.finalContract.player)return l.a.createElement("div",null,l.a.createElement("div",null,"Contract is finalized at ",e.finalContract.points),l.a.createElement("div",null,"waiting for ",e.finalContract.player," to distribute cards..."));if(0===e.treasure.length)return l.a.createElement("div",null,"Waiting for treasure cards...");var d,m=e.hand.cards.slice(),h=Object(b.a)(e.treasure);try{for(h.s();!(d=h.n()).done;){var f=d.value;m.push(f)}}catch(k){h.e(k)}finally{h.f()}var y=new P(m);y.cards.sort((function(e,t){return e.value-t.value}));for(var g=[],v=function(e){g[e]=y.cards.map((function(e,t){return l.a.createElement("option",{value:t,key:t},e.toString())})).filter((function(t,a){return(0!==e||a!==i)&&(1!==e||a!==n)})),g[e].splice(0,0,l.a.createElement("option",{value:-1,key:-1},"-- select one --"))},E=0;E<2;E++)v(E);var I=e.playerNames.filter((function(t){return t!==e.name}));function w(e,t){0===t?r(Number.parseInt(e.target.value)):u(Number.parseInt(e.target.value))}return l.a.createElement("div",{className:"distribute-cards-view"},l.a.createElement("div",null,"Must give away 2 cards"),l.a.createElement("h3",null,"Your Hand (includes treasure)"),l.a.createElement(F,{index:e.playerIndex,cards:y,phase:R.DISTRIBUTE_CARDS}),l.a.createElement("h3",null,"Cards to Give Away"),l.a.createElement("form",{onSubmit:function(t){return function(t){t.preventDefault();var a={};a[I[0]]=y.cards[n],a[I[1]]=y.cards[i];var r=y.cards.filter((function(e,t){return t!==n&&t!==i}));e.onDistribute(a,r)}(t)}},l.a.createElement("fieldset",null,l.a.createElement("label",{htmlFor:"distribute-card-0"},I[0]),l.a.createElement("select",{className:"form-control",name:"distribute-card-0",value:n,onChange:function(e){return w(e,0)}},g[0])),l.a.createElement("fieldset",null,l.a.createElement("label",{htmlFor:"distribute-card-1"},I[1]),l.a.createElement("select",{className:"form-control",name:"distribute-card-1",value:i,onChange:function(e){return w(e,1)}},g[1])),l.a.createElement("button",{type:"submit",className:"btn btn-primary form-control"},"Submit")))};function K(e){var t=e.currentTrick.map((function(e,t){return l.a.createElement("li",{key:"trick-card-".concat(t)},e.card.toString()," - ",e.player)}));return l.a.createElement("div",{className:"current-trick-container"},l.a.createElement("h3",null,"Current Trick"),e.currentTrick.length?l.a.createElement("ol",null,t):l.a.createElement("div",null,"no cards in current trick"))}function z(e){var t=Object(s.useState)([]),a=Object(p.a)(t,2),n=a[0],r=a[1],c=Object(s.useState)([]),o=Object(p.a)(c,2),i=o[0],m=o[1],h=Object(s.useState)(null),f=Object(p.a)(h,2),y=f[0],g=f[1],v=Object(s.useState)(e.finalContract.player),E=Object(p.a)(v,2),I=E[0],w=E[1],k=Object(s.useState)(-1),N=Object(p.a)(k,2),O=N[0],C=N[1],T=Object(s.useState)([]),D=Object(p.a)(T,2),A=D[0],G=D[1],B=Object(s.useState)(e.hand),H=Object(p.a)(B,2),M=H[0],J=H[1],Y=Object(s.useState)(!1),V=Object(p.a)(Y,2),W=V[0],z=V[1];function Q(){return(Q=Object(d.a)(u.a.mark((function t(a){var r,s,l,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),O){t.next=3;break}return t.abrupt("return");case 3:return r=n.reduce((function(e,t){return e+t}),0),s=M.cards[O],l=_(s,M,r,0===i.length),t.next=8,e.api.postPlayCard(e.gameId,e.round,e.name,s,l);case 8:return(c=M.cards.slice()).splice(O,1),t.next=12,J(new P(c));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function q(){return(q=Object(d.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Number.parseInt(t.target.value),e.next=3,C(a);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(s.useEffect)((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(a){var s,l,c,o,d,p;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G([].concat(Object(L.a)(A),[a.id]));case 2:if(!a.isMarriage){t.next=5;break}return t.next=5,g(a.card.suit);case 5:if(3!==(s=[].concat(Object(L.a)(i),[{card:new S(a.card.value,a.card.suit),player:a.player}])).length){t.next=19;break}return l=U(s,y),t.next=10,m([]);case 10:return c=e.playerNames.indexOf(l.player),(o=n.slice())[c]+=1,t.next=15,r(o);case 15:return t.next=17,w(l.player);case 17:t.next=25;break;case 19:return t.next=21,m(s);case 21:return d=e.playerNames.indexOf(I),p=(d+1)%3,t.next=25,w(e.playerNames[p]);case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function a(){return(a=Object(d.a)(u.a.mark((function t(){var a,n,s,l,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(W){t.next=22;break}return t.next=3,z(!0);case 3:return t.next=5,e.api.getPlayingPhaseInfo(e.gameId,e.round);case 5:return a=t.sent,t.next=8,m(a.currentTrick);case 8:return t.next=10,g(a.marriage);case 10:return t.next=12,w(a.turn);case 12:return n={},a.pastTricks.forEach((function(e){n[e.winner]+=1})),s=[],e.playerNames.forEach((function(e,t){s[t]=n[e]})),t.next=18,r(s);case 18:return l=a.pastTricks.map((function(t){var a,n=Object(b.a)(t.trick);try{for(n.s();!(a=n.n()).done;){var r=a.value,s=r.card;if(r.player===e.name)return x(s)}}catch(l){n.e(l)}finally{n.f()}throw new Error("card not found")})),c=M.cards.filter((function(e){return!l.includes(e.toString())})),t.next=22,J(new P(c));case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}e.api.addMessageListener([j.BROADCAST_PLAY_CARD],(function(a){a.gameId!==e.gameId||A.includes(a.id)||function(e){t.apply(this,arguments)}(a)})),function(){a.apply(this,arguments)}()}));var X=e.playerNames.map((function(e,t){return l.a.createElement("th",{key:"trick-player-".concat(t)},e)})),Z=e.playerNames.map((function(e,t){var a=n[t]||0;return l.a.createElement("td",{key:"trick-num-".concat(t)},a)})),$=e.hand.cards.map((function(e,t){return l.a.createElement("option",{value:t,key:t},e.toString())}));return $.splice(0,0,l.a.createElement("option",{value:-1,key:-1},"-- select a card to play --")),l.a.createElement("div",{className:"playing-view"},l.a.createElement("h3",null,"Final Contract"),l.a.createElement("div",null,e.finalContract.player," is trying to make  ",e.finalContract.points," points"),l.a.createElement("h3",null,"Tricks"),l.a.createElement("table",{className:"table table-striped table-sm"},l.a.createElement("thead",null,l.a.createElement("tr",null,X)),l.a.createElement("tbody",null,l.a.createElement("tr",null,Z))),l.a.createElement(K,{currentTrick:i}),l.a.createElement("h3",null,"Your Cards"),l.a.createElement(F,{index:e.playerIndex,cards:M,phase:R.PLAYING}),l.a.createElement("h3",null,"Play Card"),I===e.name?l.a.createElement("form",{onSubmit:function(e){return function(e){return Q.apply(this,arguments)}(e)}},l.a.createElement("label",{htmlFor:"card"},"Card"),l.a.createElement("select",{name:"card",className:"form-control",required:!0,onChange:function(e){return function(e){return q.apply(this,arguments)}(e)}},$),l.a.createElement("button",{type:"submit",className:"btn btn-primary form-control"},"Play Card")):l.a.createElement("div",null,"Waiting for ",I," to play a card..."))}var Q=function(e){var t=Object(s.useState)(R.NOT_DEALT),a=Object(p.a)(t,2),n=a[0],r=a[1],c=Object(s.useState)(null),o=Object(p.a)(c,2),i=o[0],m=o[1],h=Object(s.useState)(!1),f=Object(p.a)(h,2),y=f[0],g=f[1],b=Object(s.useState)([]),v=Object(p.a)(b,2),E=v[0],I=v[1],w=Object(s.useState)(null),k=Object(p.a)(w,2),N=k[0],O=k[1],C=Object(s.useState)(null),x=Object(p.a)(C,2),T=x[0],D=x[1],A=Object(s.useCallback)(function(){var t=Object(d.a)(u.a.mark((function t(){var a,n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.getPlayerCards(e.gameId,e.round,e.name);case 2:a=t.sent,console.log("Got cards:"),console.log(a),n=a.cards.map((function(e){return new S(e.value,e.suit)})),r=new P(n),m(r);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),[e.gameId,e.round,e.name,e.api]);function G(){return(G=Object(d.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.postDealCards(e.gameId,e.round,e.name);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function B(){return(B=Object(d.a)(u.a.mark((function t(a){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.postFinalContract(e.gameId,e.round,e.name,a);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function L(){return(L=Object(d.a)(u.a.mark((function t(a,n){var r,s;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("submitting cards for distribution:"),console.log(a),console.log("Keeping cards:"),console.log(n),t.next=6,e.api.postDistributeCards(e.gameId,e.round,e.name,a,n);case 6:return r=t.sent,t.next=9,r.json();case 9:s=t.sent,console.log("server response:"),console.log(s);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(){return(_=Object(d.a)(u.a.mark((function t(a){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.getTreasure(e.gameId,e.round);case 2:return n=t.sent,t.next=5,r(R.REVEAL_TREASURE);case 5:return t.next=7,O(a);case 7:return t.next=9,I(n);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}if(Object(s.useEffect)((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.getGameRoundInfo(e.gameId,e.round);case 2:a=t.sent,console.log("got round info for round ".concat(e.round)),console.log(a),a&&a.phase&&(r(a.phase),a.phase!==R.NOT_DEALT&&A()),a.finalContract&&D(a.finalContract),g(!0);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}y||function(){t.apply(this,arguments)}(),e.api.addMessageListener([j.BROADCAST_DEAL],(function(t){t.gameId!==e.gameId||i||A()}))}),[e.round,e.gameId,i,e.api,e.name,y,A]),Object(s.useEffect)((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.getGameRoundInfo(e.gameId,e.round);case 2:return a=t.sent,t.next=5,O(a.winningBid);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function a(){return(a=Object(d.a)(u.a.mark((function t(){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.getTreasure(e.gameId,e.round);case 2:a=t.sent,I(a);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}n!==R.REVEAL_TREASURE&&n!==R.DISTRIBUTE_CARDS||N||function(){t.apply(this,arguments)}(),n!==R.REVEAL_TREASURE&&n!==R.DISTRIBUTE_CARDS||E&&0!==E.length||function(){a.apply(this,arguments)}()}),[e.api,N,n,e.gameId,e.round,E]),Object(s.useEffect)((function(){e.api.addMessageListener([j.BROADCAST_FINAL_CONTRACT],function(){var t=Object(d.a)(u.a.mark((function t(a){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.gameId!==e.gameId){t.next=5;break}return t.next=3,r(R.DISTRIBUTE_CARDS);case 3:return t.next=5,D({points:a.points,player:a.player});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[e.api,e.gameId]),Object(s.useEffect)((function(){e.api.addMessageListener([j.BROADCAST_DISTRIBUTE_CARDS],function(){var t=Object(d.a)(u.a.mark((function t(a){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.gameId!==e.gameId){t.next=5;break}return t.next=3,r(R.PLAYING);case 3:return t.next=5,A();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[e.api,e.gameId,A]),n===R.NOT_DEALT)return e.dealer===e.playerIndex?l.a.createElement("div",{className:"round-view"},l.a.createElement("button",{type:"button",className:"btn btn-lg btn-primary",onClick:function(){return function(){return G.apply(this,arguments)}()}},"Deal")):l.a.createElement("div",{className:"round-view"},l.a.createElement("div",null,"Waiting for ",e.playerNames[e.dealer]," to deal the cards"));if(n===R.BIDDING)return i?l.a.createElement("div",{className:"round-view"},l.a.createElement(Y,{name:e.name,gameId:e.gameId,round:e.round,playerNames:e.playerNames,dealer:e.dealer,playerIndex:e.playerIndex,api:e.api,playerCards:i,onNextPhase:function(e){return _.apply(this,arguments)}})):l.a.createElement("div",{className:"round-view"},"waiting for hand from server...");if(n===R.REVEAL_TREASURE)return N?i?l.a.createElement("div",{className:"round-view"},l.a.createElement(V,{name:e.name,playerIndex:e.playerIndex,gameId:e.gameId,winningBid:N,api:e.api,treasure:E,hand:i,onSetFinalContract:function(e){return B.apply(this,arguments)}})):l.a.createElement("div",null,"Waiting for hand from server..."):l.a.createElement("div",null,"Waiting for winning bid from server...");if(n===R.DISTRIBUTE_CARDS)return T?i?l.a.createElement("div",{className:"round-view"},l.a.createElement(W,{name:e.name,gameId:e.gameId,playerIndex:e.playerIndex,round:e.round,hand:i,treasure:E,finalContract:T,playerNames:e.playerNames,onDistribute:function(e,t){return L.apply(this,arguments)}})):l.a.createElement("div",null,"Waiting for hand from server..."):l.a.createElement("div",null,"Waiting for final contract from server...");if(n===R.PLAYING)return T?i?l.a.createElement("div",{className:"round-view"},l.a.createElement(z,{name:e.name,playerIndex:e.playerIndex,gameId:e.gameId,round:e.round,finalContract:T,hand:i,playerNames:e.playerNames,api:e.api})):l.a.createElement("div",null,"Waiting for hand from server..."):l.a.createElement("div",null,"Waiting for final contract from server...");throw new Error("unknown phase: ".concat(n))},q=function(e){var t=Object(s.useState)(!!e.isCollapsed),a=Object(p.a)(t,2),n=a[0],r=a[1];for(var c=e.playerNames.map((function(e){return l.a.createElement("th",{key:"header-row-".concat(e)},e)})),o=[],i=0;i<e.round;i++)o.push(i);var u=o.map((function(t){var a=e.playerNames.map((function(a){return l.a.createElement("td",{key:"score-row-".concat(a,"-round-").concat(t)},e.scores[a][t]||0)})),n=[];return e.selectedRound===t&&n.push("table-warning"),l.a.createElement("tr",{key:"score-row-".concat(t),className:n.join(" ")},a)}));return l.a.createElement("div",{className:"score-view"},l.a.createElement("h2",null,l.a.createElement("a",{href:"#scoring-table",role:"button","data-toggle":"collapse","data-target":"#scoring-table","aria-expanded":!n,"aria-controls":"#scoring-table",onClick:function(e){return function(e){e.preventDefault(),r(!n)}(e)}},l.a.createElement("span",null,"Player Scores"),n?l.a.createElement("span",null,"\xa0(collapsed)"):null)),n?null:l.a.createElement("table",{className:"table table-striped table-sm",id:"scoring-table"},l.a.createElement("thead",null,l.a.createElement("tr",null,c)),l.a.createElement("tbody",null,u)))},X=q;var Z=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={isGameOver:!1,gameSeeds:{},round:0,scores:{},playerNames:[],dealer:0,playerIndex:-1},n.sendHeartbeat=n.sendHeartbeat.bind(Object(f.a)(n)),n.startHeartbeatTimer=n.startHeartbeatTimer.bind(Object(f.a)(n)),n.getPlayerNames=n.getPlayerNames.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"sendHeartbeat",value:function(){var e=this;this.props.api.sendMessage(j.JOIN_GAME,{gameId:this.props.gameId,username:this.props.name,isHeartbeat:!0}),window.setTimeout((function(){e.sendHeartbeat()}),6e4)}},{key:"startHeartbeatTimer",value:function(){this.sendHeartbeat()}},{key:"getPlayerNames",value:function(e){var t=this,a=Object.keys(e);return a.sort((function(e,a){return t.state.gameSeeds[e]-t.state.gameSeeds[a]})),a}},{key:"componentDidMount",value:function(){var e=this;this.props.api.addMessageListener([j.GAME_SEEDS],(function(t){if(console.log("Got game seeds from server for game ".concat(t.gameId,":")),console.log(t),t.gameId===e.props.gameId){for(var a={},n={},r=0,s=Object.entries(t.seeds);r<s.length;r++){var l=Object(p.a)(s[r],2),c=l[0],o=l[1];a[c]="number"===typeof o?o:Number.parseFloat(o)}if(t.scores)n=t.scores;else for(var i=0,u=Object.keys(a);i<u.length;i++){n[u[i]]=[0]}var d=0;t.round&&(d=t.round);var m=0;t.dealer&&(m=t.dealer);var h=e.getPlayerNames(a);e.setState({gameSeeds:a,scores:n,playerNames:h,dealer:m,playerIndex:h.indexOf(e.props.name),round:d})}})),0===Object.keys(this.state.gameSeeds).length&&this.props.api.sendMessage(j.GAME_SEEDS,{gameId:this.props.gameId,username:this.props.name}),this.startHeartbeatTimer()}},{key:"render",value:function(){return l.a.createElement("div",{className:"game-view"},l.a.createElement(q,{scores:this.state.scores,playerNames:this.state.playerNames,round:this.state.round}),this.state.playerNames?l.a.createElement(Q,{gameId:this.props.gameId,round:this.state.round,name:this.props.name,playerNames:this.state.playerNames,dealer:this.state.dealer,playerIndex:this.state.playerIndex,api:this.props.api}):l.a.createElement("div",null,"Waiting for player names from server..."))}}]),a}(l.a.Component);function $(e){var t=[].concat(Object(L.a)(e.waitingUsers),[e.name]).map((function(t,a){return t===e.name?l.a.createElement("li",{key:"lobby-user-".concat(a)},t," (you)"):l.a.createElement("li",{key:"lobby-user-".concat(a)},t)}));return l.a.createElement("div",{className:"game-lobby"},l.a.createElement("h3",null,"Game ID: ",e.gameId),l.a.createElement("p",null,"Waiting for other players to join..."),l.a.createElement("h2",null,"Users"),l.a.createElement("ul",{className:"waiting-users"},t))}function ee(){return function(){var e=document.cookie.split("; "),t={};return e.forEach((function(e){if(e.length>0){var a=e.split("="),n=Object(p.a)(a,2),r=n[0],s=n[1];t[r]=s}})),t}().name||null}var te=function(){var e=Object(s.useState)(!1),t=Object(p.a)(e,2),a=t[0],n=t[1],r=Object(s.useState)(null),c=Object(p.a)(r,2),o=c[0],i=c[1],m=new G,h=Object(s.useState)(""),f=Object(p.a)(h,2),y=f[0],g=f[1],b=Object(s.useState)([]),v=Object(p.a)(b,2),E=v[0],I=v[1];return Object(s.useEffect)((function(){function e(e){if(console.log("Received message of type ".concat(e.msgType," for game ").concat(e.gameId)),console.log(e),e.gameId===a){var t=e.users.filter((function(e){return e!==r}));console.log("got waiting users from server:"),console.log(t),I(t),2===t.length&&n(!0)}}function t(){return(t=Object(d.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("joining game ".concat(t,"...")),e.next=3,m.joinGame(t,a);case 3:if(!(n=e.sent).ok){e.next=12;break}return e.next=7,n.json();case 7:r=e.sent,console.debug("Game details:"),console.debug(r),e.next=13;break;case 12:console.error("Failed to join game");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var a=new URL(window.location.href).searchParams.get("gameid")||null;if(a){i(a);var r=ee();r?(g(r),console.debug("getting game info for game ".concat(a,"...")),m.getGameInfo(r,a).then((function(e){console.debug("game info:"),console.debug(e)})),m.socket.onopen=function(n){console.debug("Connected to API websocket"),m.addMessageListener([j.GAME_USERS],e),function(e,a){t.apply(this,arguments)}(a,r)}):window.location.href="/lounge"}else window.location.href="/lounge"}),[]),a?(o&&y||(window.location.href="/lounge"),l.a.createElement("div",{className:"App"},l.a.createElement("header",null,l.a.createElement("div",{className:"game-id"},"Game ID: ",o)),l.a.createElement("main",{className:"container app-main-container"},l.a.createElement(Z,{api:m,gameId:o,name:y})))):l.a.createElement("main",{className:"container app-main-container"},l.a.createElement($,{name:y,gameId:o,waitingUsers:E}))};a(38);function ae(e){var t=Object(s.useState)(null),a=Object(p.a)(t,2),n=a[0],r=a[1];function c(t){t.preventDefault(),n&&(!function(e){document.cookie="name=".concat(e)}(n),e.onNameSet(n))}Object(s.useEffect)((function(){var t=ee();t&&(r(t),e.onNameSet(t))}),[e]);var o=null;return e.errorMsg&&(o=l.a.createElement("div",{className:"alert alert-danger"},l.a.createElement("strong",null,"error!"),"\xa0",e.errorMsg)),l.a.createElement("div",null,l.a.createElement("h1",null,"Welcome to the Tysyacha Lounge"),o,l.a.createElement("p",null,"Please enter your name to continue"),l.a.createElement("form",{className:"name-form",onSubmit:function(e){return c(e)}},l.a.createElement("label",{htmlFor:"name"},"Name"),l.a.createElement("input",{type:"text",className:"form-control",placeholder:"name",required:!0,onChange:function(e){return function(e){r(e.target.value)}(e)}}),l.a.createElement("button",{type:"submit",className:"btn btn-primary form-control"},"Continue")))}var ne=function(e){return Object(s.useEffect)((function(){e.gameId||e.api.createGame(e.username).then((function(t){e.onGameCreated(t.gameId)}))}),[e]),e.gameId?l.a.createElement("div",{className:"create-game-view"},l.a.createElement("p",null,"New game created! Share this code with your friends to play with them."),l.a.createElement("form",null,l.a.createElement("input",{type:"text",className:"form-control",value:e.gameId,readOnly:!0}),l.a.createElement("a",{className:"btn btn-lg btn-primary form-control",href:"/game?gameid=".concat(e.gameId)},"Go To Game"))):l.a.createElement("div",{className:"create-game-view"},"creating new game...")},re=function(e){var t=Object(s.useState)(""),a=Object(p.a)(t,2),n=a[0],r=a[1];return l.a.createElement("div",{className:"join-game-view"},l.a.createElement("p",null,"When your friend creates a game they will send you a short code that you can enter below to join their game"),l.a.createElement("form",{onSubmit:function(t){return function(t){t.preventDefault(),e.api.leaveLounge(e.name),window.location.href="/game?gameid=".concat(n)}(t)}},l.a.createElement("label",{htmlFor:"game_id"},"Game ID"),l.a.createElement("input",{type:"text",className:"form-control",required:!0,placeholder:"paste your game ID here",onChange:function(e){return function(e){r(e.target.value)}(e)},name:"game_id"}),l.a.createElement("button",{type:"submit",className:"btn btn-lg btn-primary form-control"},"Join Game")))},se=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).api=void 0,n.state={name:null,loungeUsers:[],showGameCreation:!1,showGameJoin:!1,newGameId:null,isSocketError:!1},n.api=new G,n.handleNameSet=n.handleNameSet.bind(Object(f.a)(n)),n.onWebSocketMessage=n.onWebSocketMessage.bind(Object(f.a)(n)),n.showCreateGame=n.showCreateGame.bind(Object(f.a)(n)),n.handleGameCreated=n.handleGameCreated.bind(Object(f.a)(n)),n.createAiGame=n.createAiGame.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=this;document.title="Tysyacha Lounge",this.api.socket.onmessage=this.onWebSocketMessage,this.api.socket.onerror=function(t){console.error("Observed error in API websocket:"),console.error(t),e.setState({isSocketError:!0})},this.api.socket.onopen=function(t){console.log("API websocket opened successfully"),e.state.name&&e.api.joinLounge(e.state.name,!1),window.setTimeout((function(){e.state.name&&e.api.joinLounge(e.state.name,!0)}),6e4)}}},{key:"handleGameCreated",value:function(e){if(!this.state.name)throw new Error("name must be set in this method");this.setState({newGameId:e})}},{key:"onWebSocketMessage",value:function(e){if(this.setState({isSocketError:!1}),console.log("Received message over websocket:"),e.data){var t=JSON.parse(e.data);switch(console.log(t),t.msgType){case j.LOUNGE_USERS:this.setState({loungeUsers:t.users});break;case j.GAME_USERS:break;default:console.error("Got unknown msg type: ".concat(t.msgType))}}}},{key:"showCreateGame",value:function(e){this.state.name&&this.api.leaveLounge(this.state.name),this.setState({showGameCreation:e})}},{key:"showJoinGame",value:function(e){this.setState({showGameJoin:e})}},{key:"handleNameSet",value:function(e){this.setState({name:e})}},{key:"createAiGame",value:function(){var e=this;if(!this.state.name)throw new Error("must have name to use this method");this.api.createGame(this.state.name,{isComputerOnly:!0}).then((function(t){if(!e.state.name)throw new Error("must have name to use this method");e.api.leaveLounge(e.state.name),window.location.href="/game?gameid=".concat(t.gameId)}))}},{key:"render",value:function(){var e=this;if(this.state.showGameCreation&&this.state.name)return l.a.createElement("main",{className:"container"},l.a.createElement(ne,{api:this.api,gameId:this.state.newGameId,username:this.state.name,onGameCreated:this.handleGameCreated}));if(this.state.showGameJoin&&this.state.name)return l.a.createElement("main",{className:"container"},l.a.createElement(re,{name:this.state.name,api:this.api}));if(this.state.name){var t=this.state.loungeUsers.filter((function(t){return t!==e.state.name})).map((function(e,t){return l.a.createElement("div",{key:"lounge-user-".concat(t)},e)}));return l.a.createElement("main",{className:"container"},l.a.createElement("h1",null,"Welcome to the Tysyacha Lounge"),l.a.createElement("div",null,"Username: ",this.state.name),l.a.createElement("div",{className:"btn-container"},l.a.createElement("button",{type:"button",className:"btn btn-lg btn-primary",onClick:function(){return e.showCreateGame(!0)}},"Play vs Friends"),l.a.createElement("button",{type:"button",className:"btn btn-lg btn-info",onClick:function(){return e.createAiGame()}},"Play vs Computer"),l.a.createElement("button",{type:"button",className:"btn btn-lg btn-secondary",onClick:function(){return e.showJoinGame(!0)}},"Join Existing Game")),l.a.createElement("h2",null,"Other People in Lounge"),t.length?t:l.a.createElement("div",null,"lounge is currently empty"))}return l.a.createElement("main",{className:"container"},l.a.createElement(ae,{onNameSet:this.handleNameSet}))}}]),a}(l.a.Component),le=(a(39),function(e){var t=["playing-card","card-"+function(e){switch(e){case r.CLUBS:case r.SPADES:return"black";case r.DIAMONDS:case r.HEARTS:return"red"}}(e.suit)];return e.onClick&&t.push("card-active"),e.classNames&&t.push.apply(t,Object(L.a)(e.classNames)),e.isSelected&&t.push("card-selected"),e.showBack&&t.push("card-back"),e.showBack?l.a.createElement("div",{className:t.join(" ")}):l.a.createElement("div",{className:t.join(" "),onClick:function(t){return e.onClick?e.onClick(t):null}},l.a.createElement("div",{className:"card-top-right-corner"},l.a.createElement("span",{className:"value"},C(e.value)),l.a.createElement("span",{className:"suit"},e.suit)),l.a.createElement("div",{className:"card-body"}),l.a.createElement("div",{className:"card-bottom-left-corner"},l.a.createElement("span",{className:"value"},C(e.value)),l.a.createElement("span",{className:"suit"},e.suit)))}),ce=function(e){var t=[];k().forEach((function(a){e.hand.cardsBySuit[a].forEach((function(a){var n=e.hand.cards.indexOf(a),r=void 0;e.isActivePlayer&&e.onCardSelect&&(r=function(t){return a=n,void(e.isActivePlayer&&e.onCardSelect&&e.onCardSelect(e.playerIndex,a));var a});var s=l.a.createElement(le,{suit:a.suit,key:"player-card-".concat(n),value:a.value,showBack:!e.showCards,onClick:r,isSelected:e.selectedCards&&e.selectedCards.includes(n)});t.push(s)}))}));var a=e.isActivePlayer?"active-player":"";return l.a.createElement("div",{className:"player "+a},l.a.createElement("div",{className:"player-name"},e.name,e.isDealer?" (Dealer)":"",e.isContractPlayer?" (Contract)":"",e.phase!==R.BIDDING&&e.phase!==R.REVEAL_TREASURE?l.a.createElement("span",null,"\xa0(",e.numTricksTaken," tricks taken)"):null),l.a.createElement("div",{className:"player-hand"},t))},oe=function(e){var t=e.playerNames.map((function(t,a){var n=["player-name"];return a===e.localPlayerIndex&&n.push("local-player"),a===e.activePlayerIndex&&n.push("active-player"),l.a.createElement("div",{className:n.join(" "),key:"player-".concat(a)},l.a.createElement("span",null,t),e.localPlayerIndex!==a?l.a.createElement("span",null,"\xa0(AI)"):null,e.localPlayerIndex===a?l.a.createElement("span",null,"\xa0(you)"):null)}));return l.a.createElement("div",{className:"table-view"},t)};function ie(e,t){return Math.floor(Math.random()*(t-e))+e}function ue(e){var t,a=Object(b.a)(e.cards);try{for(a.s();!(t=a.n()).done;){if(t.value.value===n.ACE)return!0}}catch(r){a.e(r)}finally{a.f()}return!1}function de(e){var t,a=null,n=0,r=Object(b.a)(e.marriages);try{for(r.s();!(t=r.n()).done;){var s=t.value,l=w(s);l>n&&(n=l,a=s)}}catch(c){r.e(c)}finally{r.f()}return a}function pe(e){if(7!==e.cards.length&&8!==e.cards.length)throw new Error("[AI] Expected hand to have 7 or 8 cards in evaluation, found ".concat(e.cards.length));var t=0,a=ue(e),n=de(e);a&&n&&(t+=w(n));for(var r=0,s=Object.keys(e.cardsBySuit);r<s.length;r++)for(var l=s[r],c=N(),o=0;o<e.cardsBySuit[l].length;o++){var i=e.cardsBySuit[l][o];i.value===c[o]&&(t+=i.value)}return t%5<=2?t-t%5:t-t%5+5}function me(e,t,a,r){if(t[r].length>0&&e.marriages.length>0){var s=de(e);if(!s)throw new Error("best marriage suit cannot be null if hand has marriages");return e.findCard({value:n.QUEEN,suit:s})}return ue(e)?function(e,t){for(var a=0;a<e.cards.length;a++){if(e.cards[a].value===t)return a}return-1}(e,n.ACE):function(e,t,a){var n=e.cards.filter((function(a){return function(e,t,a){if(0===t.length)return!0;var n=t[0].card.suit;return a.suit===n||0===e.cardsBySuit[n].length}(e,t,a)}));if(0===n.length)throw new Error("somehow cannot play any card in my hand");var r=n[ie(0,n.length)],s=e.cards.indexOf(r);if(-1===s)throw new Error("bug in playRandomCard");return s}(e,[])}function he(e,t,a){var r=t[a],s=t.filter((function(e,t){return t!==a}));if(2!==s.length)throw new Error("there must be exactly 2 other players");for(var l={},c=-1,o=0;o<e.cards.length;o++)for(var i=o+1;i<e.cards.length;i++){var u=e.cards[o],d=e.cards[i],p=Object(L.a)(e.cards);p.splice(i,1),p.splice(o,1);var m=new P(p);if(!(m.marriages.length<2)||u.value!==n.ACE&&d.value!==n.ACE){var h=pe(m);h>c&&(l[s[0]]=u,l[s[1]]=d,c=h)}}return console.debug("[AI] Best assignment gives ".concat(r," an estimated ").concat(c," points")),l}var fe={getBid:function(e,t,a){var n=M(e),r={player:a,points:0},s=pe(t);return console.debug("".concat(a," AI evaluated hand at ").concat(s," points")),n&&s>n.points||!n&&s>=60?{points:s,player:a}:r},playCard:function(e,t,a,n,r){if(0===e.cards.length)throw new Error("player hand cannot be empty");if(0===t.length){var s=me(e,a,0,r);if(-1===s)throw new Error("[AI] bug in playLeadingCard for AI ".concat(r," - returned -1"));return s}var l=function(e,t,a,n,r){var s=t[0].card.suit,l=H(t,n).card;if(e.cardsBySuit[s].length>0){var c=e.cardsBySuit[s][0],o=0;o=l.suit!==s||c.value<l.value?e.cardsBySuit[s].length-1:0;var i=e.cardsBySuit[s][o],u=e.cards.indexOf(i);if(u<0)throw new Error("AI error in leading suit logic");return u}if(n&&e.cardsBySuit[n].length>0){var d=0;if(l.suit===s||l.suit!==n)d=e.cardsBySuit[n].length-1;else d=e.cardsBySuit[n][0].value>l.value?0:e.cardsBySuit[n].length-1;var p=e.cardsBySuit[n][d],m=e.cards.indexOf(p);if(m<0)throw new Error("AI error in trump suit logic");return m}var h,f=1e3,y=e.cards[0],g=Object(b.a)(e.cards);try{for(g.s();!(h=g.n()).done;){var v=h.value;v.value<f&&(y=v,f=v.value)}}catch(I){g.e(I)}finally{g.f()}var E=e.cards.indexOf(y);if(E<0)throw new Error("AI error in fall-through suit logic");return E}(e,t,0,n);if(-1===l)throw new Error("[AI] bug in playFollowingCard for AI ".concat(r," - returned -1"));return l},reevalContract:function(e,t,a,n,r){var s=n[r];if(!e)throw new Error("[AI] hand is undefined in reevalContract for player ".concat(s));for(var l=[].concat(Object(L.a)(e.cards),Object(L.a)(t)),c=new P(l),o=he(c,n,r),i=Object.values(o),u=Object(L.a)(c.cards),d=0;d<i.length;d++){var p=i[d],m=u.indexOf(p);u.splice(m,1)}var h=pe(new P(u));return h>a?h:a},distributeCards:he},ye=function(e){if(e.localPlayerIndex!==e.contractPlayerIndex)throw new Error("Only use this view when the human player is distributing the cards");var t=e.playerNames[e.contractPlayerIndex],a=e.playerHands[t],n=Object(s.useState)(-1),r=Object(p.a)(n,2),c=r[0],o=r[1],i=Object(s.useState)(-1),u=Object(p.a)(i,2),d=u[0],m=u[1],h=Object(s.useState)({}),f=Object(p.a)(h,2),y=f[0],g=f[1];function b(e){var t=Number.parseInt(e.target.value);o(t)}var v=e.playerNames[e.localPlayerIndex],E=l.a.createElement("div",null,l.a.createElement(ce,{name:v,playerIndex:e.localPlayerIndex,hand:a,phase:R.BIDDING,isDealer:e.localPlayerIndex===e.dealerIndex,tricksTaken:[],numTricksTaken:0,isContractPlayer:e.localPlayerIndex===e.contractPlayerIndex,isActivePlayer:e.localPlayerIndex===e.contractPlayerIndex,showCards:!0,onCardSelect:function(e,t){console.log(t),m(t)}})),I=l.a.createElement("p",null,"You won the contract! You hold a contract for ",e.contractPoints," points. You must now select one card each to distribute to each of your two opponents."),w=null;w=-1===d?l.a.createElement("p",null,"Select a card to give away"):l.a.createElement("p",null,"You have selected ",a.cards[d].toString());var k=[];e.playerNames.forEach((function(t,a){if(a!==e.localPlayerIndex){var n=l.a.createElement("div",{className:"form-check",key:"check-".concat(a)},l.a.createElement("input",{className:"form-check-input",type:"radio",name:"targetPlayer",value:a,onChange:b}),l.a.createElement("label",{htmlFor:"targetPlayer",className:"form-check-label"},t));k.push(n)}}));var N=l.a.createElement("div",{className:"target-players"},l.a.createElement("p",null,"Select the target player"),k),O=null;if(Object.keys(y).length>0){var C=[];e.playerNames.forEach((function(t,n){if(n!==e.localPlayerIndex){var r=l.a.createElement("tr",{key:"row-".concat(n)},l.a.createElement("td",null,t),l.a.createElement("td",null,t in y?a.cards[y[t]].toString():"unassigned"));C.push(r)}})),O=l.a.createElement("div",{className:"assignment-table-container"},l.a.createElement("h2",null,"Assignments"),l.a.createElement("table",{className:"table table-striped"},l.a.createElement("tbody",null,C)),l.a.createElement("button",{type:"button",className:"btn btn-success btn-lg",disabled:2!==Object.keys(y).length,onClick:function(){var t={};Object.entries(y).forEach((function(e){var n=Object(p.a)(e,2),r=n[0],s=n[1],l=a.cards[s];t[r]=l})),e.onDistribute(t)}},"Finalize Card Assignments"))}return l.a.createElement("div",{className:"container distribute-cards-view"},l.a.createElement("div",{className:"dealt-table"},I,l.a.createElement("div",{className:"player-hand-container"},l.a.createElement("h2",null,"Your Hand"),E),w,N,-1!==c&&-1!==d?l.a.createElement("div",null,l.a.createElement("p",null,"Give the ",a.cards[d].toString()," to ",e.playerNames[c],"?"),l.a.createElement("button",{type:"button",className:"btn btn-success",onClick:function(){if(e.localPlayerIndex===c)throw new Error("cannot assign cards to yourself");var t={};Object.assign(t,y);var a=e.playerNames[c];t[a]=d;for(var n=null,r=0;r<e.playerNames.length;r++)r!==e.localPlayerIndex&&r!==c&&(n=e.playerNames[r]);if(null===n)throw new Error("failed to find other player's name");t[n]===t[a]&&delete t[n],g(t)}},"OK")):null,O))},ge=function(e){var t=e.playerNames[e.contractPlayerIndex],a=e.playerNames[e.localPlayerIndex],n=Object(s.useState)(!1),r=Object(p.a)(n,2),c=r[0],o=r[1],i=Object(s.useState)({}),u=Object(p.a)(i,2),d=u[0],m=u[1];var h=e.playerHands[a];if(c){var f=Object(L.a)(h.cards),y=d[a];f.push(y),h=new P(f)}return l.a.createElement("div",{className:"container distribute-cards-view distribute-cards-view-other"},l.a.createElement(oe,{playerNames:e.playerNames,localPlayerIndex:e.localPlayerIndex,activePlayerIndex:e.contractPlayerIndex}),l.a.createElement("p",{className:"instructions"},"Now the contract player (",t,") will distribute one card to each of the other players (including you)."),c?null:l.a.createElement("button",{type:"button",className:"btn btn-lg btn-info",onClick:function(){var a=fe.distributeCards(e.playerHands[t],e.playerNames,e.contractPlayerIndex);m(a),o(!0)}},"Continue"),c?l.a.createElement("div",{className:"post-distribute-text"},l.a.createElement("p",null,"You have just received the card ",d[a].toString()," from ",t,"."),l.a.createElement("button",{type:"button",className:"btn btn-success btn-lg",onClick:function(){e.onDistribute(d)}},"Continue")):null,l.a.createElement("div",{className:"player-hand-container"},l.a.createElement("h2",null,"Your Hand"),l.a.createElement(ce,{name:a,playerIndex:e.localPlayerIndex,hand:h,phase:R.DISTRIBUTE_CARDS,isDealer:e.localPlayerIndex===e.dealerIndex,tricksTaken:[],numTricksTaken:0,isContractPlayer:!1,isActivePlayer:!1,showCards:!0})))},be=function(e){return e.localPlayerIndex===e.contractPlayerIndex?l.a.createElement(ye,{playerNames:e.playerNames,localPlayerIndex:e.localPlayerIndex,dealerIndex:e.dealerIndex,playerHands:e.playerHands,contractPoints:e.contractPoints,contractPlayerIndex:e.contractPlayerIndex,onDistribute:e.onDistribute}):l.a.createElement(ge,{playerNames:e.playerNames,localPlayerIndex:e.localPlayerIndex,dealerIndex:e.dealerIndex,playerHands:e.playerHands,contractPoints:e.contractPoints,contractPlayerIndex:e.contractPlayerIndex,onDistribute:e.onDistribute})},ve=function(e){if(!e.declaredMarriages)throw new Error("declared marriages is null");var t=function(e,t,a,n){var r={},s={};e.forEach((function(e){var n=function(e){var t=e.map((function(e){return function(e){return e.map((function(e){return e.card.value})).reduce((function(e,t){return e+t}),0)}(e)})).reduce((function(e,t){return e+t}),0);return t%5<3?t-t%5:t+(5-t%5)}(t[e]);e in a&&a[e].forEach((function(e){n+=w(e)})),r[e]=n,s[e]=0}));var l,c=Object(b.a)(e);try{for(c.s();!(l=c.n()).done;){var o=l.value;o===n.player?r[o]>=n.points?s[o]=n.points:s[o]=-1*n.points:s[o]=r[o]}}catch(i){c.e(i)}finally{c.f()}return{raw:r,final:s}}(e.playerNames,e.tricksTaken,e.declaredMarriages,e.contract),a=t.final,n=t.raw,r=e.contract.player,s=a[r]>0,c=e.playerNames.map((function(t,s){var c=e.tricksTaken[t].map((function(e,t){var a=e.map((function(e,a){return l.a.createElement(le,{key:"player-".concat(s,"-tricks-taken-").concat(t,"-card-").concat(a),classNames:["trick-card-".concat(a)],suit:e.card.suit,value:e.card.value})}));return l.a.createElement("div",{className:"trick-taken",key:"player-".concat(s,"-tricks-taken-").concat(t)},a)})),o=t in e.declaredMarriages?e.declaredMarriages[t].length:0,i=o>0?e.declaredMarriages[t].join(" "):"";return l.a.createElement("div",{className:"player-tricks-taken-container",key:"player-".concat(s,"-tricks-taken-container")},l.a.createElement("h4",null,t),c.length>0?l.a.createElement("div",null,l.a.createElement("div",null,c.length," tricks taken - ",t===r?"".concat(n[t]," points (contract was ").concat(e.contract.points," points)"):"".concat(a[t]," points")),l.a.createElement("div",null,o," marriages declared",o>0?": "+i:null),l.a.createElement("div",{className:"player-tricks-taken"},c)):l.a.createElement("div",null,"no tricks taken - 0 points"))}));return l.a.createElement("div",{className:"table container"},l.a.createElement("div",{className:"game-status"},l.a.createElement("h3",null,"Status"),l.a.createElement("div",null,e.contract.player," holds contract for ",e.contract.points," points"),l.a.createElement("div",null,"".concat(r,s?" met the contract":" failed to meet the contract"))),l.a.createElement("div",{className:"player-tricks"},l.a.createElement("h3",null,"Taken Tricks"),c),e.onFinish?l.a.createElement("button",{type:"button",className:"btn btn-primary btn-lg",onClick:function(t){return e.onFinish?e.onFinish(a):null}},"Start Next Round"):null)},Ee=function(e){function t(e,t){return l.a.createElement("td",{key:"bid-".concat(t)},e.points>0?e.points:"pass")}for(var a=[l.a.createElement("th",{key:"blank"},"round")],n=0;n<3;n++){var r=e.playerNames[(e.startingBidPlayer+n)%3];a.push(l.a.createElement("th",{key:"name-".concat(n)},r))}for(var s=[],c=1,o=[],i=0;i<e.bidHistory.length;i++){if(3===o.length){var u=l.a.createElement("tr",{key:"round-".concat(c)},l.a.createElement("td",null,c),o);s.push(u),c++,o=[]}var d=e.bidHistory[i];o.push(t(d,i))}if(o.length>0){for(var p=0;o.length<3;)o.push(l.a.createElement("td",{key:"blank-".concat(p)})),p++;var m=l.a.createElement("tr",{key:"round-".concat(c)},l.a.createElement("td",null,c),o);s.push(m)}return l.a.createElement("div",{className:"bid-history"},l.a.createElement("h2",null,"Bidding History"),0===e.bidHistory.length?l.a.createElement("p",null,"no bids yet"):l.a.createElement("table",{className:"table table-striped table-sm"},l.a.createElement("thead",null,l.a.createElement("tr",null,a)),l.a.createElement("tbody",null,s)))},Ie=function(e){var t=(e.dealerIndex+1)%3,a=Object(s.useState)(t),n=Object(p.a)(a,2),r=n[0],c=n[1],o=Object(s.useState)([]),i=Object(p.a)(o,2),u=i[0],d=i[1],m=Object(s.useState)(0),h=Object(p.a)(m,2),f=h[0],y=h[1],g=Object(s.useState)(""),b=Object(p.a)(g,2),v=b[0],E=b[1],I=Object(s.useState)([]),w=Object(p.a)(I,2),k=w[0],N=w[1];function O(e,t){d([].concat(Object(L.a)(u),[e])),c((r+1)%3),0!==e.points||k.includes(t)||N([].concat(Object(L.a)(k),[t]))}Object(s.useEffect)((function(){if(function(e){for(var t=[],a=!1,n=0;n<e.length;n++){var r=e[n];t.includes(r.player)||(0===r.points?t.push(r.player):a=!0)}return 3===t.length||a&&2===t.length}(u)){var t=M(u);e.onNextPhase(t),N([]),E(""),y(0),d([])}}));var C=e.playerNames[e.localPlayerIndex],S=e.playerHands[C],x=l.a.createElement("div",null,l.a.createElement(ce,{name:C,playerIndex:e.localPlayerIndex,hand:S,phase:R.BIDDING,isDealer:e.localPlayerIndex===e.dealerIndex,tricksTaken:[],numTricksTaken:0,isContractPlayer:!1,isActivePlayer:e.localPlayerIndex===r,showCards:!0}),l.a.createElement("div",null,S.getPoints()," points in hand"),l.a.createElement("div",null,"Marriages: ",S.marriages.length>0?S.marriages.join(" "):"none"));return l.a.createElement("div",{className:"bidding-view"},l.a.createElement(oe,{playerNames:e.playerNames,localPlayerIndex:e.localPlayerIndex,activePlayerIndex:r}),l.a.createElement(Ee,{playerNames:e.playerNames,startingBidPlayer:t,bidHistory:u}),l.a.createElement("div",{className:"round-info"},l.a.createElement("p",null,"It is ",e.playerNames[r],"'s turn to bid.")),l.a.createElement("div",{className:"player-action-container"},r===e.localPlayerIndex?l.a.createElement("form",{className:"bidding-form"},l.a.createElement("label",null,"Points"),l.a.createElement("input",{type:"number",name:"points",min:0,max:400,step:5,className:"form-control",onChange:function(e){var t=Number.parseInt(e.target.value);if(t<0)E("points cannot be negative");else if(0===t)E("cannot bid 0");else{if(t%5!==0)return void E("points can only be moved in increments of 5");if(t<60)return void E("this bid is beneath the points minimum");E(""),y(t)}}}),v?l.a.createElement("p",{className:"error-msg"},v):null,l.a.createElement("div",{className:"btn-group"},l.a.createElement("button",{type:"button",className:"btn btn-lg btn-success",onClick:function(){k.includes(e.localPlayerIndex)&&E("you cannot submit a bid - you have already passed");var t=M(u);if(t&&t.points>=f)E("your bid is lower than the current highest bid");else{var a=e.playerNames[r];O({points:f,player:a},e.localPlayerIndex)}},disabled:0===f||""!==v||k.includes(e.localPlayerIndex)},"Submit Bid"),l.a.createElement("button",{type:"button",className:"btn btn-lg btn-danger",onClick:function(){O({points:0,player:e.playerNames[r]},e.localPlayerIndex)}},"Pass"))):l.a.createElement("button",{type:"button",className:"btn btn-primary btn-lg",onClick:function(){if(r===e.localPlayerIndex)throw new Error("method can only be called for AI players");var t=e.playerNames[r];O(k.includes(r)?{points:0,player:t}:fe.getBid(u,e.playerHands[t],t),r)}},"AI Bid")),l.a.createElement("div",{className:"player-hand-container"},l.a.createElement("h2",null,"Your Hand"),x))},we=function(e){var t=e.playerNames[e.contractPlayerIndex],a=Object(s.useState)(0),n=Object(p.a)(a,2),r=n[0],c=n[1],o=Object(s.useState)(""),i=Object(p.a)(o,2),u=i[0],d=i[1],m=Object(s.useState)(!1),h=Object(p.a)(m,2),f=h[0],y=h[1];var g=e.treasure.map((function(e,t){return l.a.createElement("div",{key:"treasure-card-container-".concat(t)},l.a.createElement(le,{key:"treasure-card-".concat(t),suit:e.suit,value:e.value}),null)})),b=e.playerNames[e.localPlayerIndex],v=l.a.createElement("div",null,l.a.createElement(ce,{name:b,playerIndex:e.localPlayerIndex,hand:e.playerHands[b],phase:R.BIDDING,isDealer:e.localPlayerIndex===e.dealerIndex,tricksTaken:[],numTricksTaken:0,isContractPlayer:e.localPlayerIndex===e.contractPlayerIndex,isActivePlayer:e.localPlayerIndex===e.contractPlayerIndex,showCards:!0})),E=null;return E=e.localPlayerIndex===e.contractPlayerIndex?l.a.createElement("p",null,"Congratulations! You won the contract for ",e.contractPoints," points. I hope you like the treasure. You may now increase your contract if you wish."):l.a.createElement("p",null,"Unfortunately you did not win the bidding.\xa0",t," won the bidding instead and currently holds a contract for ",e.contractPoints," points. In any case, each player sees the previously hidden treasure cards.\xa0",t," may now choose to increase the contract or keep it the same."),l.a.createElement("div",{className:"container reveal-treasure-view"},l.a.createElement("div",{className:"dealt-table"},l.a.createElement("div",null,l.a.createElement("h3",null,"Treasure"),l.a.createElement("div",{className:"treasure-container"},g)),l.a.createElement("div",{className:"player-hand-container"},l.a.createElement("h2",null,"Your Hand"),v),E,e.localPlayerIndex===e.contractPlayerIndex?l.a.createElement("form",{onSubmit:function(t){if(t.preventDefault(),r<=e.contractPoints)d("this is not more than your current contract");else{if(r%5===0)return e.onFinalizeContract(r),!1;d("contract points must be a multiple of 5")}}},l.a.createElement("input",{type:"number",className:"form-control",name:"points",min:e.contractPoints,max:400,step:5,placeholder:"please enter your new contract points",onChange:function(e){var t=Number.parseInt(e.target.value);c(t)}}),u?l.a.createElement("div",{className:"error-msg"},u):null,l.a.createElement("div",{className:"btn-group"},l.a.createElement("button",{type:"submit",className:"btn btn-success btn-lg",disabled:r<e.contractPoints},"Increase Contract"),l.a.createElement("button",{type:"submit",className:"btn btn-danger btn-lg",onClick:function(){e.onFinalizeContract(e.contractPoints)}},"Keep Current Contract"))):l.a.createElement("div",null,f?null:l.a.createElement("button",{type:"button",className:"btn btn-info btn-lg",onClick:function(){var t=e.playerNames[e.contractPlayerIndex],a=fe.reevalContract(e.playerHands[t],e.treasure,e.contractPoints,e.playerNames,e.contractPlayerIndex);if(a<e.contractPoints)throw new Error("AI returned a lower contract than the one it started with");c(a),y(!0)}},"Evaluate AI Turn"),f?l.a.createElement("div",null,r===e.contractPoints?"".concat(t," has decided to keep the contract unchanged."):"".concat(t," has decided to increase the contract to ").concat(r," points.")):null,f?l.a.createElement("button",{type:"button",className:"btn btn-success btn-lg",onClick:function(){if(!f)throw new Error("AI must think first");e.onFinalizeContract(r)}},"Continue"):null)))};function ke(e,t,a,r){if(t<0||t>=e.cards.length)throw new Error("cardIndex is invalid - ".concat(t));var s=e.cards[t];return!(0!==a.length||s.value!==n.KING&&s.value!==n.QUEEN||!(r>0)||!e.marriages.includes(s.suit))}var Ne=function(e){var t=Object(s.useState)(!0),a=Object(p.a)(t,2),r=a[0],c=(a[1],Object(s.useState)(-1)),o=Object(p.a)(c,2),i=o[0],u=o[1];var d=e.playerNames[e.localPlayerIndex],m=null;e.localPlayerIndex===e.contractPlayerIndex&&(m=l.a.createElement("p",{className:"instructions"},"You are now fulfilling the contract for ",e.contractPoints," points. Since this is your contract, you get to go first. Remember, you can't declare a marriage on the first turn."));var h=e.currentTrick.map((function(e,t){return l.a.createElement(le,{key:"card-".concat(t),suit:e.card.suit,value:e.card.value})})),f=null;if(e.localPlayerIndex===e.activePlayerIndex&&e.currentTrick.length<3)f="It is your turn. Play a card.";else if(e.currentTrick.length<3)f="It is ".concat(e.playerNames[e.activePlayerIndex],"'s turn.");else if(3===e.currentTrick.length){var y=U(e.currentTrick,e.trumpSuit);f="".concat(y.player," has won the trick.")}e.trumpSuit?f+=" The current trump is ".concat(e.trumpSuit,"."):f+=" There is currently no trump suit.";var g=null;if(-1!==i){var b=e.playerHands[d].cards[i];if((b.value===n.KING||b.value===n.QUEEN)&&0===e.currentTrick.length)e.playerHands[d].marriages.includes(b.suit)&&(g=e.numPastTricks>0?l.a.createElement("div",{className:"alert alert-info"},"Playing this card will automatically declare the ",b.suit," marriage"):l.a.createElement("div",{className:"alert alert-warning"},l.a.createElement("strong",null,"Warning!\xa0"),"You must first take a trick before declaring the ",b.suit," marriage"))}return l.a.createElement("div",{className:"trick-taking-view"},l.a.createElement(oe,{playerNames:e.playerNames,localPlayerIndex:e.localPlayerIndex,activePlayerIndex:e.activePlayerIndex}),r?m:null,l.a.createElement("div",{className:"current-trick-wrapper"},e.currentTrick.length>0?l.a.createElement("h2",null,"Current Trick"):null,e.currentTrick.length>0&&e.currentTrick[0].isMarriage?l.a.createElement("p",null,e.currentTrick[0].player," declared a ",e.currentTrick[0].card.suit," marriage"):null,l.a.createElement("div",{className:"current-trick-container"},h)),l.a.createElement("div",{className:"player-hand-container"},l.a.createElement("div",{className:"turn-container"},l.a.createElement("h5",null,f)),l.a.createElement(ce,{name:d,playerIndex:e.localPlayerIndex,hand:e.playerHands[d],phase:R.PLAYING,isDealer:e.dealerIndex===e.localPlayerIndex,isContractPlayer:e.contractPlayerIndex===e.localPlayerIndex,isActivePlayer:e.activePlayerIndex===e.localPlayerIndex,showCards:!0,numTricksTaken:e.tricksTaken[d].length,tricksTaken:e.tricksTaken[d],selectedCards:-1===i?[]:[i],onCardSelect:function(e,t){u(t===i?-1:t)}}),g,l.a.createElement("form",null,e.activePlayerIndex===e.localPlayerIndex&&e.currentTrick.length<3?l.a.createElement("button",{type:"button",className:"btn btn-success btn-lg play-card-btn",disabled:-1===i,onClick:function(){if(-1===i)throw new Error("no selected card");var t=e.playerNames[e.activePlayerIndex],a=e.playerHands[t],n={player:t,card:a.cards[i],isMarriage:ke(a,i,e.currentTrick,e.numPastTricks)};e.onPlayCard(n),u(-1)}},"Play Card"):null,e.activePlayerIndex!==e.localPlayerIndex&&e.currentTrick.length<3?l.a.createElement("button",{type:"button",className:"btn btn-info btn-lg",onClick:function(){var t=e.playerNames[e.activePlayerIndex],a=e.playerHands[t],n=fe.playCard(a,e.currentTrick,e.tricksTaken,e.trumpSuit,t);if(n<0||n>=a.cards.length)throw new Error("AI ".concat(t," returned cardIndex ").concat(n," which is invalid"));var r={player:t,card:a.cards[n],isMarriage:ke(a,n,e.currentTrick,e.numPastTricks)};e.onPlayCard(r)}},"AI Turn"):null,3===e.currentTrick.length?l.a.createElement("button",{type:"button",className:"btn btn-success btn-lg",onClick:e.onDimissTrick},"OK"):null)))},Oe=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;Object(m.a)(this,a),n=t.call(this,e);var r=Object.fromEntries(n.props.playerNames.map((function(e){return[e,[]]})));return n.state={phase:R.NOT_DEALT,playerHands:{},treasure:[],currentContract:null,contractPlayerIndex:0,activePlayerIndex:(n.props.dealerIndex+1)%3,currentTrick:[],trumpSuit:null,tricksTaken:r,trickNumber:0,declaredMarriages:{}},n.dealCards=n.dealCards.bind(Object(f.a)(n)),n.handleCompleteBidding=n.handleCompleteBidding.bind(Object(f.a)(n)),n.handleFinalizeContract=n.handleFinalizeContract.bind(Object(f.a)(n)),n.handleDistributeCards=n.handleDistributeCards.bind(Object(f.a)(n)),n.handlePlayCard=n.handlePlayCard.bind(Object(f.a)(n)),n.handleNextRound=n.handleNextRound.bind(Object(f.a)(n)),n.handleDismissTrick=n.handleDismissTrick.bind(Object(f.a)(n)),n.resetRound=n.resetRound.bind(Object(f.a)(n)),n.readSavedState=n.readSavedState.bind(Object(f.a)(n)),n.persistState=n.persistState.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.readSavedState().then((function(t){t?e.setState({phase:t.phase,playerHands:t.playerHands,treasure:t.treasure,currentContract:t.currentContract,contractPlayerIndex:t.contractPlayerIndex,activePlayerIndex:t.activePlayerIndex}):e.persistState()}))}},{key:"persistState",value:function(){console.debug("Persisting state for game ".concat(this.props.gameId," and round ").concat(this.props.roundNum,"..."));var e=JSON.stringify({phase:this.state.phase,playerHands:this.state.playerHands,treasure:this.state.treasure,currentContract:this.state.currentContract,contractPlayerIndex:this.state.contractPlayerIndex,activePlayerIndex:this.state.activePlayerIndex});window.localStorage.setItem("game:".concat(this.props.gameId,":round:").concat(this.props.roundNum),e),console.debug("state has been persisted")}},{key:"readSavedState",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,a,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.debug("Trying to load saved state from local storage for game ".concat(this.props.gameId," and round ").concat(this.props.roundNum,"...")),!(t=window.localStorage.getItem("game:".concat(this.props.gameId,":round:").concat(this.props.roundNum)))){e.next=13;break}return a=JSON.parse(t),n={},Object.entries(a.playerHands).forEach((function(e){var t=Object(p.a)(e,2),a=t[0],r=t[1].cards.map((function(e){return new S(e.value,e.suit)}));n[a]=new P(r)})),a.playerHands=n,r=a.treasure.map((function(e){return new S(e.value,e.suit)})),a.treasure=r,console.debug(a),e.abrupt("return",a);case 13:return console.debug("not found"),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleFinalizeContract",value:function(e){var t=this;if(console.assert(this.state.phase===R.REVEAL_TREASURE),!this.state.currentContract)throw new Error("there must be an existing contract");if(e<this.state.currentContract.points)throw new Error("cannot reduce contract point value");var a=this.state.currentContract.player,n={player:a,points:e},r=this.state.playerHands[a].cards,s=[].concat(Object(L.a)(r),Object(L.a)(this.state.treasure)),l=Object.assign({},this.state.playerHands);l[a]=new P(s),this.setState({currentContract:n,phase:R.DISTRIBUTE_CARDS,playerHands:l},(function(){t.persistState()}))}},{key:"handlePlayCard",value:function(e){var t=this.props.playerNames.indexOf(e.player);if(t!==this.state.activePlayerIndex)throw new Error("can only call this method to play a card by the active player");if(this.state.currentTrick.length>=3)throw new Error("cannot play additional cards after the current trick has 3 or more cards");var a=this.state.playerHands[e.player].findCard(e.card);if(-1===a)throw new Error("cannot find card ".concat(e.card," in player ").concat(e.player,"'s hand"));var n=this.props.playerNames[t],r=this.state.playerHands[n].cards[a];console.log("[trick ".concat(this.state.trickNumber,"] ").concat(n," -> card ").concat(r));var s=ke(this.state.playerHands[n],a,this.state.currentTrick,this.state.trickNumber);if(!s&&e.isMarriage)throw new Error("player is telling us this is a marriage but we are not seeing it");s&&console.debug("".concat(n," declared a marriage -> ").concat(r.suit));var l=this.state.currentTrick.slice();l.push(e);var c=this.state.playerHands[n].cards.slice();c.splice(c.indexOf(r),1);var o=Object.assign({},this.state.playerHands);if(o[n]=new P(c),3===l.length){var i=U(l,this.state.trumpSuit),u=this.props.playerNames.indexOf(i.player);this.setState({currentTrick:l,playerHands:o,activePlayerIndex:u})}else{var d=(this.state.activePlayerIndex+1)%3,p=this.state.declaredMarriages;s&&(n in(p=Object.assign({},this.state.declaredMarriages))||(p[n]=[]),p[n].push(r.suit)),this.setState({currentTrick:l,activePlayerIndex:d,trumpSuit:s?r.suit:this.state.trumpSuit,declaredMarriages:p,playerHands:o})}}},{key:"handleDismissTrick",value:function(){var e=U(this.state.currentTrick,this.state.trumpSuit),t=this.props.playerNames.indexOf(e.player),a={};Object.assign(a,this.state.tricksTaken);var n=this.props.playerNames[t];a[n].push(this.state.currentTrick),console.log("[trick ".concat(this.state.trickNumber,"] ").concat(n," won the trick. They play the next hand."));var r=!1;0===this.state.playerHands[e.player].cards.length&&(r=!0),this.setState({currentTrick:[],activePlayerIndex:t,tricksTaken:a,phase:r?R.SCORING:R.PLAYING,trickNumber:this.state.trickNumber+1})}},{key:"handleBolt",value:function(){for(var e={},t=0;t<this.props.playerNames.length;t++){var a=this.props.playerNames[t];t===this.props.dealerIndex?e[a]=-120:e[a]=0}this.resetRound(),this.props.onRoundOver(e,!0)}},{key:"dealCards",value:function(){var e=this;console.log("Dealing cards...");for(var t=new T(this.props.randomSeed),a=[],n=0;n<3;n++)a.push(t.pop());for(var r={},s=0;s<3;s++){for(var l=this.props.playerNames[s],c=[],o=0;o<7;o++)c.push(t.pop());var i=new P(c);r[l]=i}this.setState({treasure:a,phase:R.BIDDING,playerHands:r},(function(){e.props.onChangePhase(R.BIDDING),console.log("cards have been dealt"),e.persistState()}))}},{key:"handleDistributeCards",value:function(e){var t=this;console.assert(this.state.phase===R.DISTRIBUTE_CARDS),console.assert(2===Object.keys(e).length),console.assert(3===this.state.treasure.length);for(var a=this.props.playerNames[this.state.contractPlayerIndex],n=this.state.playerHands[a].cards,r=Object.assign({},this.state.playerHands),s=0,l=Object.entries(e);s<l.length;s++){var c=Object(p.a)(l[s],2),o=c[0],i=c[1];if(o===a)throw new Error("cannot assign card to yourself");var u=n.indexOf(i);if(-1===u)throw new Error("cannot find the card in the big hand");if(!(o in r))throw new Error("name ".concat(o," must be in playerHands"));var d=r[o].cards.slice();d.push(i),r[o]=new P(d),n.splice(u,1)}r[a]=new P(n),this.setState({playerHands:r,phase:R.PLAYING,activePlayerIndex:this.state.contractPlayerIndex},(function(){t.persistState()}))}},{key:"resetRound",value:function(){var e=this,t=Object.fromEntries(this.props.playerNames.map((function(e){return[e,[]]})));this.setState({phase:R.NOT_DEALT,treasure:[],playerHands:{},currentContract:null,contractPlayerIndex:-1,activePlayerIndex:-1,currentTrick:[],trumpSuit:null,tricksTaken:t,trickNumber:0,declaredMarriages:{}},(function(){e.persistState()}))}},{key:"handleCompleteBidding",value:function(e){var t=this;if(console.log("bidding is complete"),e){var a=this.props.playerNames.indexOf(e.player);this.setState({currentContract:e,contractPlayerIndex:a,phase:R.REVEAL_TREASURE},(function(){t.props.onChangePhase(R.REVEAL_TREASURE),t.persistState()}))}else this.props.onRoundOver({},!0),this.resetRound()}},{key:"handleNextRound",value:function(e){this.props.onRoundOver(e,!1),this.resetRound()}},{key:"render",value:function(){switch(this.state.phase){case R.NOT_DEALT:return l.a.createElement("div",{className:"dealing-view"},l.a.createElement(oe,{playerNames:this.props.playerNames,localPlayerIndex:this.props.localPlayerIndex,activePlayerIndex:this.props.dealerIndex}),l.a.createElement("div",{className:"instructions"},this.props.numFailedDeals>0?l.a.createElement("span",null,"The last deal failed - 3 passes in a row.\xa0"):null,this.props.playerNames[this.props.dealerIndex]," is dealing."),l.a.createElement("div",{className:"action-container"},l.a.createElement("button",{type:"button",className:"btn btn-success btn-lg",onClick:this.dealCards},"Deal")));case R.BIDDING:return l.a.createElement(Ie,{playerNames:this.props.playerNames,dealerIndex:this.props.dealerIndex,playerHands:this.state.playerHands,onNextPhase:this.handleCompleteBidding,localPlayerIndex:this.props.localPlayerIndex});case R.REVEAL_TREASURE:if(!this.state.currentContract)throw new Error("Current contract is not set in REVEAL_TREASURE phase");return l.a.createElement(we,{localPlayerIndex:this.props.localPlayerIndex,playerNames:this.props.playerNames,dealerIndex:this.props.dealerIndex,playerHands:this.state.playerHands,contractPlayerIndex:this.state.contractPlayerIndex,contractPoints:this.state.currentContract.points,treasure:this.state.treasure,onFinalizeContract:this.handleFinalizeContract});case R.DISTRIBUTE_CARDS:if(!this.state.currentContract)throw new Error("Current contract is not set in DISTRIBUTE_CARDS phase");return l.a.createElement(be,{localPlayerIndex:this.props.localPlayerIndex,playerNames:this.props.playerNames,dealerIndex:this.props.dealerIndex,playerHands:this.state.playerHands,contractPlayerIndex:this.state.contractPlayerIndex,contractPoints:this.state.currentContract.points,onDistribute:this.handleDistributeCards});case R.PLAYING:if(!this.state.currentContract)throw new Error("there must be a contract in this pahse");return l.a.createElement(Ne,{playerNames:this.props.playerNames,localPlayerIndex:this.props.localPlayerIndex,dealerIndex:this.props.dealerIndex,contractPlayerIndex:this.state.contractPlayerIndex,contractPoints:this.state.currentContract.points,playerHands:this.state.playerHands,currentTrick:this.state.currentTrick,activePlayerIndex:this.state.activePlayerIndex,tricksTaken:this.state.tricksTaken,trumpSuit:this.state.trumpSuit,numPastTricks:this.state.trickNumber,onPlayCard:this.handlePlayCard,onDimissTrick:this.handleDismissTrick});case R.SCORING:if(!this.state.currentContract)throw new Error("there must be a contract in this pahse");return l.a.createElement(ve,{contract:this.state.currentContract,contractPlayerIndex:this.state.contractPlayerIndex,tricksTaken:this.state.tricksTaken,declaredMarriages:this.state.declaredMarriages,playerNames:this.props.playerNames,onFinish:this.handleNextRound});default:return l.a.createElement("div",null,"no view for phase ",this.state.phase)}}}]),a}(s.PureComponent),Ce=function(e){for(var t=e.playerNames.map((function(e){return l.a.createElement("th",{key:"header-row-".concat(e)},e)})),a=[],n=0;n<e.currentRound;n++)a.push(n);var r=a.map((function(t){var a=e.playerNames.map((function(a){return l.a.createElement("td",{key:"score-row-".concat(a,"-round-").concat(t)},e.scores[a][t]||0)})),n=[];return e.currentRound-1===t&&n.push("table-primary"),l.a.createElement("tr",{key:"score-row-".concat(t),className:n.join(" ")},l.a.createElement("td",null,t||"start"),a)}));return l.a.createElement("div",{className:"score-view-modal modal fade show",id:"score-view-modal","aria-modal":"true",tabIndex:-1,style:{display:"block"}},l.a.createElement("div",{className:"modal-dialog modal-dialog-centered"},l.a.createElement("div",{className:"modal-content"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("h5",{className:"modal-title"},"Player Scores"),l.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:function(t){return e.onDismiss()}},l.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),l.a.createElement("div",{className:"modal-body"},l.a.createElement("table",{className:"table table-sm",id:"scoring-table"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Round"),t)),l.a.createElement("tbody",null,r))),l.a.createElement("div",{className:"modal-footer"},l.a.createElement("button",{type:"button",className:"btn btn-secondary","data-dismiss":"modal",onClick:function(t){return e.onDismiss()}},"Close")))))},Se=(a(40),function(e){function t(t){var a=new URL(t.target.href).hash;e.setNavHash?e.setNavHash(a):function(e){console.debug("Using default hash handler in navbar");var t=new URL(window.location.href);t.hash=e,console.debug("Hash is now ".concat(e)),window.location.href=t.toString(),window.location.reload()}(a)}return l.a.createElement("nav",{className:"navbar navbar-expand-md navbar-light bg-light",id:"tysyacha-navbar"},l.a.createElement("a",{className:"navbar-brand",href:"#",onClick:t},"Tysyacha"),l.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},l.a.createElement("span",{className:"navbar-toggler-icon"})),l.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},l.a.createElement("ul",{className:"navbar-nav mr-auto"},e.gameId?l.a.createElement("li",{className:"nav-item"},l.a.createElement("a",{className:"#local-ai-game"===e.hash?"nav-link active":"nav-link",href:"#local-ai-game",onClick:t},"Game")):null,l.a.createElement("li",{className:"nav-item"},l.a.createElement("a",{className:"#rules"===e.hash?"nav-link active":"nav-link",href:"#rules",onClick:t},"Rules")))))}),xe=function(e){return l.a.createElement("div",null)};var je=["Alisa","Elena","Gallina","Misha","Boris"],Pe=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;Object(m.a)(this,a);var r=function(e){if(!e)throw new Error("player name cannot be empty");window.localStorage.setItem("playerName",e);var t=je.indexOf(e),a=[].concat(je);t>=0&&a.splice(t,1);for(var n=[e];n.length<3;){t=ie(0,a.length);var r=a.splice(t,1),s=Object(p.a)(r,1)[0];n.push(s)}return n}((n=t.call(this,e)).props.playerName),s=function(e){var t={};return e.forEach((function(e){t[e]=[0]})),t}(r),l=function(e){var t={};return e.forEach((function(e){t[e]=-1})),t}(r),c=r.indexOf(e.playerName);return n.state={isGameReady:!1,isGameOver:!1,playerNames:r,dealerIndex:0,scores:s,barrelTurnCount:l,winningPlayers:[],round:1,isAllCardsShown:!1,localPlayerIndex:c,numFailedDeals:0,phase:R.NOT_DEALT,isIntroDialogShown:!0,isScorecardShown:!1,randomSeed:1},n.onRoundOver=n.onRoundOver.bind(Object(f.a)(n)),n.saveGameState=n.saveGameState.bind(Object(f.a)(n)),n.loadGameState=n.loadGameState.bind(Object(f.a)(n)),n.getBoltScores=n.getBoltScores.bind(Object(f.a)(n)),n.handleChangePhase=n.handleChangePhase.bind(Object(f.a)(n)),n.handleChangeViewScorecard=n.handleChangeViewScorecard.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"saveGameState",value:function(){var e=JSON.stringify(this.state);window.localStorage.setItem("game:".concat(this.props.gameId),e),console.debug("saved game state for game ".concat(this.props.gameId))}},{key:"loadGameState",value:function(){console.debug("Trying to load saved game state from local storage for game ".concat(this.props.gameId,"..."));var e=window.localStorage.getItem("game:".concat(this.props.gameId));if(e){console.debug("found game state for this game in localstorage:");var t=JSON.parse(e);return console.debug(t),this.setState({playerNames:Object(L.a)(t.playerNames),localPlayerIndex:t.localPlayerIndex,dealerIndex:t.dealerIndex,round:t.round,scores:t.scores,numFailedDeals:t.numFailedDeals,isIntroDialogShown:t.isIntroDialogShown||!1}),this.setState({isGameReady:!0}),!0}return this.setState({isGameReady:!0}),!1}},{key:"componentDidMount",value:function(){this.loadGameState()||(console.debug("no previous game state found for game ".concat(this.props.gameId)),this.saveGameState())}},{key:"getBoltScores",value:function(){for(var e={},t=0;t<this.state.playerNames.length;t++){var a=this.state.playerNames[t];t===this.state.dealerIndex?e[a]=-120:e[a]=0}return e}},{key:"onRoundOver",value:function(e,t){var a=this;if(t&&this.state.numFailedDeals<2)console.log("round ".concat(this.state.round," ended early")),this.setState({numFailedDeals:this.state.numFailedDeals+1},(function(){console.log("number of failed deals is now ".concat(a.state.numFailedDeals)),a.saveGameState()}));else{console.assert(this.state.round>0),t&&2===this.state.numFailedDeals?(console.log("3 failed deals! Bolt!"),e=this.getBoltScores()):console.log(e),console.log("Round ".concat(this.state.round," is over."));var n=Object.assign({},this.state.scores);console.log(this.state.scores);for(var r=0,s=Object.entries(e);r<s.length;r++){var l=Object(p.a)(s[r],2),c=l[0],o=l[1];n[c][this.state.round-1]||(n[c][this.state.round-1]=0),n[c][this.state.round]=n[c][this.state.round-1]+o}var i,u=function(e){var t=[];return Object.entries(e).forEach((function(e){var a=Object(p.a)(e,2),n=a[0],r=a[1];880===r[r.length-1]&&t.push(n)})),t}(this.state.scores),d=Object.assign({},this.state.barrelTurnCount),m=[],h=Object(b.a)(this.state.playerNames);try{for(h.s();!(i=h.n()).done;){var f=i.value,y=u.includes(f);n[f][this.state.round-1]>=880&&n[f][this.state.round-1]<1e3?y&&2===d[f]?(n[f][this.state.round-1]=760,d[f]=-1,console.debug("".concat(f," has been on the barrel for a full 3 turns and has failed to meet a contract. They are thrown off."))):(y?console.debug("".concat(f," has now been on the barrel for ").concat(d[f]+1," turns")):(console.debug("".concat(f," is now on the barrel")),console.assert(-1===d[f])),d[f]+=1):n[f][this.state.round-1]>=1e3?(m.push(f),!0):y&&(d[f]=-1,console.debug("".concat(f," has fallen off the barrel due to a contract")))}}catch(g){h.e(g)}finally{h.f()}this.setState({scores:n,round:this.state.round+1,dealerIndex:(this.state.dealerIndex+1)%3,numFailedDeals:0},(function(){a.saveGameState()}))}}},{key:"handleChangePhase",value:function(e){this.setState({phase:e})}},{key:"handleDismissIntroDialog",value:function(){var e=this;this.setState({isIntroDialogShown:!1},(function(){e.saveGameState()}))}},{key:"handleChangeViewScorecard",value:function(e){this.setState({isScorecardShown:e})}},{key:"handleChangeHash",value:function(e){var t=new URL(window.location.href);t.hash=e,console.debug("[local game view] Hash is now ".concat(e)),window.location.href=t.toString(),window.location.reload()}},{key:"render",value:function(){var e=this,t=null;return t=this.state.isGameReady?l.a.createElement(Oe,{randomSeed:this.state.randomSeed,gameId:this.props.gameId,roundNum:this.state.round,isAllCardsShown:this.state.isAllCardsShown,playerNames:this.state.playerNames,dealerIndex:this.state.dealerIndex,onRoundOver:this.onRoundOver,numFailedDeals:this.state.numFailedDeals,localPlayerIndex:this.state.localPlayerIndex,onChangePhase:this.handleChangePhase}):l.a.createElement(xe,null),l.a.createElement("div",{className:"wrapper"},l.a.createElement("header",null,l.a.createElement(Se,{gameId:this.props.gameId,hash:window.location.hash,setNavHash:this.handleChangeHash})),l.a.createElement("main",{className:"container"},l.a.createElement("div",{className:"main-control-panel"},l.a.createElement("button",{type:"button",className:"btn btn-info btn-lg","data-toggle":"modal","data-target":"#score-view-modal",onClick:function(t){return e.handleChangeViewScorecard(!e.state.isScorecardShown)}},this.state.isScorecardShown?"Hide Scorecard":"View Scorecard")),this.state.isScorecardShown?l.a.createElement("div",null,l.a.createElement(Ce,{currentRound:this.state.round,playerNames:this.state.playerNames,scores:this.state.scores,onDismiss:function(){return e.handleChangeViewScorecard(!1)}}),l.a.createElement("div",{className:"modal-backdrop fade show",onClick:function(){return e.handleChangeViewScorecard(!1)}})):null,t))}}]),a}(s.PureComponent),Te=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;Object(m.a)(this,a),n=t.call(this,e);var r="undefined"!==typeof e.isCollapsed&&e.isCollapsed;return n.state={isCollapsed:r},n.toggleCollapse=n.toggleCollapse.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"toggleCollapse",value:function(e){e.preventDefault(),this.setState({isCollapsed:!this.state.isCollapsed})}},{key:"render",value:function(){var e=this,t=this.props.playerNames.map((function(e,t){return l.a.createElement("li",{key:"player=".concat(t)},e)}));return l.a.createElement("div",{className:"admin-player-container"},l.a.createElement("h2",null,l.a.createElement("a",{href:"#player-container-collapse",role:"button","data-toggle":"collapse","data-target":"#player-container-collapse","aria-expanded":!this.state.isCollapsed,"aria-controls":"player-container-collapse",onClick:function(t){return e.toggleCollapse(t)}},l.a.createElement("span",null,"Players"),this.state.isCollapsed?l.a.createElement("span",null,"\xa0(collapsed)"):null)),this.state.isCollapsed?null:l.a.createElement("div",{id:"player-container-collapse"},this.props.playerNames.length>0?l.a.createElement("ol",null,t):l.a.createElement("div",null,"no players registered")))}}]),a}(l.a.PureComponent),De=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;Object(m.a)(this,a),n=t.call(this,e);var r="undefined"!==typeof e.isCollapsed&&e.isCollapsed;return n.state={isCollapsed:r},n.toggleCollapse=n.toggleCollapse.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"toggleCollapse",value:function(e){e.preventDefault(),this.setState({isCollapsed:!this.state.isCollapsed})}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"admin-game-info-container"},l.a.createElement("div",{id:"game-info-header"},l.a.createElement("h2",null,l.a.createElement("a",{href:"#game-info-collapse",role:"button","data-toggle":"collapse","data-target":"#game-info-collapse","aria-expanded":this.state.isCollapsed,"aria-controls":"game-info-collapse",onClick:function(t){return e.toggleCollapse(t)}},l.a.createElement("span",null,"Game Info"),this.state.isCollapsed?l.a.createElement("span",null,"\xa0(collapsed)"):null))),this.state.isCollapsed?null:l.a.createElement("div",{id:"game-info-collapse","aria-labelledby":"game-info-header"},l.a.createElement("div",null,"Round - ",this.props.gameInfo.round," "),l.a.createElement("div",null,"Game Creator - ",this.props.gameInfo.creator," "),l.a.createElement("div",null,"Has Started? - ",this.props.gameInfo.hasStarted?"yes":"no"," ")))}}]),a}(l.a.PureComponent),Ae=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).handleSelectRound=n.handleSelectRound.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"handleSelectRound",value:function(e,t){}},{key:"render",value:function(){var e=this,t=this.props.rounds.map((function(t){var a=t===e.props.gameInfo.round,n=["game-round"];return a&&n.push("active"),l.a.createElement("li",{key:"round-".concat(t)},l.a.createElement("a",{href:"/server?game=".concat(e.props.gameId,"&round=").concat(t),className:n.join(" "),onClick:function(a){return e.handleSelectRound(a,t)}},l.a.createElement("span",null,"Round ",t),a?l.a.createElement("span",null,"\xa0(active)"):null))}));return l.a.createElement("div",null,l.a.createElement("h1",{className:"title"},"Game ",this.props.gameId),l.a.createElement(X,{scores:this.props.gameInfo.scores,playerNames:this.props.playerNames,round:this.props.gameInfo.round}),l.a.createElement(De,{gameInfo:this.props.gameInfo}),l.a.createElement("div",{className:"admin-rounds-container"},this.props.rounds.length>0?l.a.createElement("div",null,l.a.createElement("h2",null,"Rounds"),l.a.createElement("ol",null,t)):l.a.createElement("div",null,"no rounds")))}}]),a}(l.a.PureComponent),Re=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).handleSelectGame=n.handleSelectGame.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"handleSelectGame",value:function(e,t){}},{key:"render",value:function(){var e=this,t=Object.entries(this.props.games).map((function(t){var a=Object(p.a)(t,2),n=a[0],r=a[1].hasStarted;return l.a.createElement("li",{key:"game-link-".concat(n)},l.a.createElement("a",{href:"/server?game=".concat(n),onClick:function(t){return e.handleSelectGame(t,n)}},l.a.createElement("span",null,r?n:"".concat(n," (not started - waiting for players to join)"))))}));return l.a.createElement("div",{className:"games-container"},l.a.createElement("h1",{className:"title"},"Tysyacha Server"),l.a.createElement("h2",null,"Games"),t.length>0?l.a.createElement("ol",null,t):l.a.createElement("div",null,"no games"))}}]),a}(l.a.PureComponent),Ge=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={selectedPlayer:null},n.selectPlayer=n.selectPlayer.bind(Object(f.a)(n)),n.onSelect=n.onSelect.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"selectPlayer",value:function(e){e===this.state.selectedPlayer?this.setState({selectedPlayer:null}):this.setState({selectedPlayer:e})}},{key:"onSelect",value:function(e){this.state.selectedPlayer&&this.props.onSelect(this.state.selectedPlayer,e)}},{key:"render",value:function(){var e=this,t=this.props.contractPlayerCards.cards.slice();t.push.apply(t,Object(L.a)(this.props.treasureCards));var a=new P(t),n=[];Object.entries(a.cardsBySuit).forEach((function(t){var a=Object(p.a)(t,2),r=a[0];a[1].forEach((function(t,a){var s=Object.values(e.props.selectedCards).includes(t),c=null;if(s)for(var o=0,i=Object.entries(e.props.selectedCards);o<i.length;o++){var u=Object(p.a)(i[o],2),d=u[0],m=u[1];t===m&&(c=d)}var h=l.a.createElement("div",{key:"distribute-card-container-".concat(r,"-").concat(a)},l.a.createElement(le,{key:"distribute-card-".concat(a),suit:t.suit,value:t.value,classNames:s?["card-selected"]:[],onClick:function(a){return e.onSelect(t)}}),c?l.a.createElement("div",{className:"target-player"},"sending to ",c):null);n.push(h)}))}));var r=this.props.playerNames.filter((function(t){return t!==e.props.contractPlayer})).map((function(t,a){var n=["btn","btn-secondary"],r=e.state.selectedPlayer===t;return r&&n.push("active"),l.a.createElement("label",{key:"player-".concat(a),className:n.join(" ")},l.a.createElement("input",{type:"radio",name:"options",id:"options-".concat(a),autoComplete:"off",checked:r,onChange:function(a){return e.selectPlayer(t)}})," ",t)}));return l.a.createElement("form",{className:"distribute-cards-form"},l.a.createElement("div",{className:"btn-group btn-group-toggle","data-toggle":"buttons"},r),l.a.createElement("div",{className:"player-hand"},n),l.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.props.onDistribute()}},"Distribute Cards"))}}]),a}(l.a.PureComponent),Be=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={api:new B,bid:-1,selectedCards:{}},n.onDealClick=n.onDealClick.bind(Object(f.a)(n)),n.onBidChange=n.onBidChange.bind(Object(f.a)(n)),n.onBidClick=n.onBidClick.bind(Object(f.a)(n)),n.onPassClick=n.onPassClick.bind(Object(f.a)(n)),n.onFinalizeContractClick=n.onFinalizeContractClick.bind(Object(f.a)(n)),n.toggleSelectCard=n.toggleSelectCard.bind(Object(f.a)(n)),n.onDistribute=n.onDistribute.bind(Object(f.a)(n)),n.onPlayCard=n.onPlayCard.bind(Object(f.a)(n)),n.onNextRound=n.onNextRound.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"toggleSelectCard",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=Object.assign({},this.state.selectedCards))[t]=a,this.setState({selectedCards:n});case 3:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onDealClick",value:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.state.api.postDealCards(this.props.gameId,this.props.gameInfo.round,this.props.roundInfo.dealer);case 2:window.location.reload();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onBidChange",value:function(e){var t=Number.parseInt(e.target.value);this.setState({bid:t})}},{key:"onPassClick",value:function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.state.api.postBid(this.props.gameId,this.props.gameInfo.round,this.props.roundInfo.biddingPlayer,0);case 3:window.location.reload();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBidClick",value:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.state.api.postBid(this.props.gameId,this.props.gameInfo.round,this.props.roundInfo.biddingPlayer,this.state.bid);case 2:window.location.reload();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onFinalizeContractClick",value:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.roundInfo.winningBid){e.next=2;break}throw new Error("Cannot finalize contract without having a winning bid");case 2:return e.next=4,this.state.api.postFinalContract(this.props.gameId,this.props.gameInfo.round,this.props.roundInfo.winningBid.player,this.state.bid);case 4:window.location.reload();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onDistribute",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.roundInfo.finalContract){e.next=2;break}throw new Error("Cannot distribute cards without having a final contract");case 2:if(this.props.playerCards&&this.props.treasure){e.next=4;break}throw new Error("player cards or treasure not set");case 4:if(2===Object.keys(this.state.selectedCards).length){e.next=6;break}throw new Error("Must select 2 players and 1 card per player");case 6:if(t=[],a=Object.values(this.state.selectedCards),this.props.playerCards[this.props.roundInfo.finalContract.player].cards.forEach((function(e){a.includes(e)||t.push(e)})),this.props.treasure.forEach((function(e){a.includes(e)||t.push(e)})),8===t.length){e.next=12;break}throw new Error("kept cards must be 8 cards in length");case 12:return e.next=14,this.state.api.postDistributeCards(this.props.gameId,this.props.gameInfo.round,this.props.roundInfo.finalContract.player,this.state.selectedCards,t);case 14:window.location.reload();case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onPlayCard",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var r,s,l,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.playerCards){e.next=2;break}throw new Error("player cards not set");case 2:return r=this.props.playerNames[t],s=this.props.playerCards[r],l=s.cards[a],c=!1,!s.marriages.includes(l.suit)||l.value!==n.KING&&l.value!==n.QUEEN||(c=!0),e.next=9,this.state.api.postPlayCard(this.props.gameId,this.props.gameInfo.round,r,l,c);case 9:window.location.reload();case 10:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onNextRound",value:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.state.api.postEndRound(this.props.gameId,this.props.gameInfo.round,this.props.gameInfo.creator);case 2:window.location.href="/server?game=".concat(this.props.gameId);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=null;if(this.props.roundInfo.phase===R.PLAYING&&this.props.playingPhaseInfo&&this.props.roundInfo.finalContract&&this.props.playerCards){var a=this.props.playingPhaseInfo.turn,n=0,r=[];this.props.playingPhaseInfo.pastTricks.map((function(e){e.winner===a&&(n+=1,r.push(e.trick))})),t=l.a.createElement(ce,{name:this.props.playingPhaseInfo.turn,playerIndex:this.props.playerNames.indexOf(a),hand:this.props.playerCards[a],phase:this.props.roundInfo.phase,isDealer:this.props.roundInfo.dealer===a,isContractPlayer:this.props.roundInfo.finalContract.player===a,isActivePlayer:!0,numTricksTaken:n,tricksTaken:r,onCardSelect:this.onPlayCard,showCards:!1})}return l.a.createElement("div",{className:"btn-container"},this.props.roundInfo.phase===R.NOT_DEALT?l.a.createElement("button",{className:"btn btn-success",disabled:this.props.roundInfo.phase!==R.NOT_DEALT,onClick:this.onDealClick},"Deal - ",this.props.roundInfo.dealer):null,this.props.roundInfo.phase===R.BIDDING?l.a.createElement("form",{className:"bidding-form"},l.a.createElement("h3",null,"Bidding"),l.a.createElement("label",{htmlFor:"bid"},"Bid for ",this.props.roundInfo.biddingPlayer," "),l.a.createElement("input",{type:"number",name:"bid",className:"form-control",placeholder:"enter bid",min:100,max:500,disabled:this.props.roundInfo.phase!==R.BIDDING,onChange:function(t){return e.onBidChange(t)}}),l.a.createElement("button",{className:"btn btn-info form-control",type:"button",onClick:function(t){return e.onPassClick(t)}},"Send Pass - ",this.props.roundInfo.biddingPlayer),l.a.createElement("button",{className:"btn btn-success form-control",type:"button",onClick:this.onBidClick},"Send Bid - ",this.props.roundInfo.biddingPlayer)):null,this.props.roundInfo.phase===R.REVEAL_TREASURE&&this.props.roundInfo.winningBid?l.a.createElement("form",{className:"final-contract-form"},l.a.createElement("h3",null,"Final Contract"),l.a.createElement("label",{htmlFor:"bid"},"Final Contract for ",this.props.roundInfo.winningBid.player," "),l.a.createElement("input",{type:"number",name:"bid",className:"form-control",placeholder:"enter final contract",min:this.props.roundInfo.winningBid.points,max:500,onChange:function(t){return e.onBidChange(t)}}),l.a.createElement("button",{className:"btn btn-success form-control",type:"button",onClick:this.onFinalizeContractClick},"Finalize Contract - ",this.props.roundInfo.winningBid.player)):null,this.props.roundInfo.phase===R.DISTRIBUTE_CARDS&&this.props.roundInfo.finalContract&&this.props.playerCards&&this.props.treasure?l.a.createElement(Ge,{contractPlayerCards:this.props.playerCards[this.props.roundInfo.finalContract.player],treasureCards:this.props.treasure,selectedCards:this.state.selectedCards,playerNames:this.props.playerNames,contractPlayer:this.props.roundInfo.finalContract.player,onSelect:this.toggleSelectCard,onDistribute:this.onDistribute}):null,t,this.props.roundInfo.phase===R.SCORING?l.a.createElement("form",{className:"next-round-form"},l.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.onNextRound()}},"Next Round")):null)}}]),a}(l.a.PureComponent),Le=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(){return Object(m.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"render",value:function(){var e=this.props.pastTricks.map((function(e,t){var a=e.trick.map((function(e){return e.card.value})).reduce((function(e,t){return e+t}),0),n=e.trick.map((function(e,a){return l.a.createElement("span",{key:"trick-".concat(t,"-card-").concat(a)},a>0?l.a.createElement("span",null,",\xa0"):null,l.a.createElement("span",null,e.card.suit),l.a.createElement("span",null,C(e.card.value)))}));return l.a.createElement("div",{className:"past-trick",key:"past-trick-".concat(t)},l.a.createElement("div",null,l.a.createElement("span",null,"trick ",t+1,":\xa0"),l.a.createElement("span",null,"winner - ",e.winner,"\xa0"),l.a.createElement("span",null,"(",a," points)")),l.a.createElement("div",null,n))}));return l.a.createElement("div",null,l.a.createElement("h2",null,"Past Tricks"),e.length?e:l.a.createElement("div",null,"no past tricks"))}}]),a}(l.a.PureComponent),_e=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(){return Object(m.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"render",value:function(){var e=this.props.treasureCards.map((function(e,t){return l.a.createElement("span",{key:"treasure-".concat(t)},e.toString())}));return l.a.createElement("div",{className:"admin-treasure-container"},l.a.createElement("h3",null,l.a.createElement("span",null,"Treasure"),this.props.roundInfo.phase===R.BIDDING?l.a.createElement("span",null,"\xa0(hidden from players)"):l.a.createElement("span",null,"\xa0(revealed to players)")),e)}}]),a}(l.a.PureComponent),He=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(){return Object(m.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"render",value:function(){var e=this.props.playerNames[this.props.contractPlayerIndex],t=this.props.contractPlayerIndex,a=this.props.playerHands[e].cards.slice();a.push.apply(a,Object(L.a)(this.props.treasure));var n=new P(a),r=l.a.createElement(ce,{key:"player-".concat(t),name:e,playerIndex:this.props.contractPlayerIndex,hand:n,phase:R.REVEAL_TREASURE,isDealer:t===this.props.dealerIndex,isContractPlayer:!0,isActivePlayer:!0,tricksTaken:[],numTricksTaken:0,showCards:!1});return l.a.createElement("div",{className:"table container"},l.a.createElement("div",{className:"dealt-table"},l.a.createElement("div",{className:"player-hands"},l.a.createElement("h3",null,"Large Hand"),r)))}}]),a}(l.a.PureComponent),Ue=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={isCollapsed:!1},n.toggleCollapse=n.toggleCollapse.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"toggleCollapse",value:function(e){e.preventDefault(),this.setState({isCollapsed:!this.state.isCollapsed})}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"round-info-container"},l.a.createElement("h2",null,l.a.createElement("a",{href:"#round-info-collapse",role:"button",onClick:function(t){return e.toggleCollapse(t)}},l.a.createElement("span",null,"Round ",this.props.round," Info"),this.state.isCollapsed?l.a.createElement("span",null,"\xa0 (collapsed)"):null)),this.state.isCollapsed?null:l.a.createElement("div",{id:"round-info-collapse"},l.a.createElement("div",null,"Phase - ",function(e){switch(e){case R.NOT_DEALT:return"NOT_DEALT";case R.BIDDING:return"BIDDING";case R.REVEAL_TREASURE:return"REVEAL_TREASURE";case R.DISTRIBUTE_CARDS:return"DISTRIBUTE_CARDS";case R.PLAYING:return"PLAYING";case R.SCORING:return"SCORING"}}(this.props.roundInfo.phase)),l.a.createElement("div",null,"Dealer - ",this.props.roundInfo.dealer),this.props.roundInfo.phase===R.BIDDING?l.a.createElement("div",null,"Current Bidder - ",this.props.roundInfo.biddingPlayer):null,this.props.roundInfo.phase===R.REVEAL_TREASURE&&this.props.roundInfo.winningBid?l.a.createElement("div",null,"Winning Bid - ",this.props.roundInfo.winningBid.points," (",this.props.roundInfo.winningBid.player,")"):null,this.props.roundInfo.phase>=R.DISTRIBUTE_CARDS&&this.props.roundInfo.finalContract?l.a.createElement("div",null,"Final Contract - ",this.props.roundInfo.finalContract.points," (",this.props.roundInfo.finalContract.player,")"):null,this.props.roundInfo.phase===R.PLAYING&&this.props.playingPhaseInfo?l.a.createElement("div",null,"Current Turn - ",this.props.playingPhaseInfo.turn):null,this.props.roundInfo.phase===R.PLAYING&&this.props.playingPhaseInfo?l.a.createElement("div",null,"Current Trump - ",this.props.playingPhaseInfo.marriage?this.props.playingPhaseInfo.marriage:"none"):null))}}]),a}(l.a.PureComponent),Me=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={},n.isActivePlayer=n.isActivePlayer.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"isActivePlayer",value:function(e){switch(this.props.roundInfo.phase){case R.NOT_DEALT:return!1;case R.BIDDING:return e===this.props.roundInfo.biddingPlayer;case R.REVEAL_TREASURE:var t=M(this.props.bidHistory);if(!t)throw new Error("bid history must always have a winner in the REVEAL_TREASURE phase");return t.player===e;case R.DISTRIBUTE_CARDS:if(!this.props.roundInfo.finalContract)throw new Error("final contract must always be set in DISTRIBUTE_CARDS phase");return this.props.roundInfo.finalContract.player===e;case R.PLAYING:return!!this.props.playingPhaseInfo&&this.props.playingPhaseInfo.turn===e;default:return!1}}},{key:"render",value:function(){var e=this,t=-1;this.props.roundInfo&&this.props.roundInfo.finalContract&&(t=this.props.playerNames.indexOf(this.props.roundInfo.finalContract.player));var a=null;this.props.roundInfo&&this.props.roundInfo.phase>R.NOT_DEALT&&this.props.cards&&this.props.cards.playerCards&&(a=this.props.playerNames.map((function(t,a){if(!e.props.cards)throw new Error("cards not set");var n=e.isActivePlayer(t)?"active-player":"";return l.a.createElement("div",{key:"player-".concat(a,"-container")},l.a.createElement("h5",{className:"player-name "+n},t),l.a.createElement(F,{key:"player-".concat(a),index:a,cards:e.props.cards.playerCards[t],phase:e.props.roundInfo.phase}))})));var n=null;if(this.props.roundInfo.phase===R.SCORING&&this.props.roundInfo.finalContract&&this.props.playingPhaseInfo&&this.props.playingPhaseInfo){var r=function(e,t){var a={};return e.forEach((function(e){a[e]=[]})),t.forEach((function(e){a[e.winner].push(e.trick)})),a}(this.props.playerNames,this.props.playingPhaseInfo.pastTricks);n=l.a.createElement(ve,{contract:this.props.roundInfo.finalContract,contractPlayerIndex:t,playerNames:this.props.playerNames,tricksTaken:r,declaredMarriages:this.props.playingPhaseInfo.declaredMarriages})}var s=this.props.round===this.props.gameInfo.round;return l.a.createElement("div",null,l.a.createElement("h1",{className:"title"},l.a.createElement("span",null,"Game ",this.props.gameId," - Round ",this.props.round)),s?null:l.a.createElement("h3",null,l.a.createElement("span",{className:"badge badge-danger"},"Round Over")),this.props.gameInfo.hasStarted?l.a.createElement(X,{round:this.props.gameInfo.round,selectedRound:this.props.round,scores:this.props.gameInfo.scores,playerNames:this.props.playerNames,isCollapsed:this.props.roundInfo.phase!==R.SCORING&&this.props.roundInfo.phase!==R.NOT_DEALT}):l.a.createElement(Te,{playerNames:this.props.playerNames,isCollapsed:!1}),l.a.createElement(De,{gameInfo:this.props.gameInfo,isCollapsed:!0}),l.a.createElement(Ue,{roundInfo:this.props.roundInfo,round:this.props.round,playingPhaseInfo:this.props.playingPhaseInfo}),this.props.roundInfo.phase>R.NOT_DEALT?l.a.createElement(J,{isCollapsed:this.props.roundInfo.phase===R.PLAYING||this.props.roundInfo.phase===R.SCORING,bids:this.props.bidHistory}):null,this.props.playingPhaseInfo&&this.props.roundInfo.phase>=R.PLAYING&&this.props.roundInfo.phase<R.SCORING?l.a.createElement(Le,{pastTricks:this.props.playingPhaseInfo.pastTricks}):null,this.props.playingPhaseInfo&&this.props.roundInfo.phase>=R.PLAYING&&this.props.roundInfo.phase<R.SCORING?l.a.createElement(K,{currentTrick:this.props.playingPhaseInfo.currentTrick}):null,this.props.roundInfo.phase>R.NOT_DEALT&&this.props.roundInfo.phase<=R.DISTRIBUTE_CARDS&&this.props.cards?l.a.createElement(_e,{treasureCards:this.props.cards.treasure,roundInfo:this.props.roundInfo}):null,this.props.roundInfo.phase>R.NOT_DEALT&&this.props.roundInfo.phase<R.SCORING?l.a.createElement("div",{className:"admin-player-cards-container"},l.a.createElement("h3",null,"Player Cards"),a):null,this.props.roundInfo.phase===R.REVEAL_TREASURE&&this.props.cards&&this.props.roundInfo.winningBid?l.a.createElement(He,{playerNames:this.props.playerNames,playerHands:this.props.cards.playerCards,treasure:this.props.cards.treasure,dealerIndex:this.props.playerNames.indexOf(this.props.roundInfo.dealer),contractPlayerIndex:this.props.playerNames.indexOf(this.props.roundInfo.winningBid.player)}):null,n,s?l.a.createElement(Be,{roundInfo:this.props.roundInfo,gameInfo:this.props.gameInfo,playingPhaseInfo:this.props.playingPhaseInfo,gameId:this.props.gameId,playerNames:this.props.playerNames,playerCards:this.props.cards?this.props.cards.playerCards:null,treasure:this.props.cards?this.props.cards.treasure:null}):null)}}]),a}(l.a.PureComponent),Fe=function(e){Object(g.a)(a,e);var t=Object(y.a)(a);function a(e){var n;return Object(m.a)(this,a),(n=t.call(this,e)).state={gameId:null,round:-1,games:{},api:new G,playerNames:[],rounds:[],gameInfo:null,roundInfo:{},cardsPerRound:{},bidHistory:[],playingPhaseInfo:null,errorMsg:null},n.loadGames=n.loadGames.bind(Object(f.a)(n)),n.loadGameInfo=n.loadGameInfo.bind(Object(f.a)(n)),n.loadRoundBids=n.loadRoundBids.bind(Object(f.a)(n)),n.loadData=n.loadData.bind(Object(f.a)(n)),n.onSelectGame=n.onSelectGame.bind(Object(f.a)(n)),n.onSelectRound=n.onSelectRound.bind(Object(f.a)(n)),n}return Object(h.a)(a,[{key:"loadGameInfo",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Getting game info for game ".concat(t,"...")),e.next=3,this.state.api.adminGetGameInfo(t);case 3:a=e.sent,console.log(a),this.setState({gameId:t,playerNames:a.playerNames,rounds:a.rounds,gameInfo:a.gameInfo,roundInfo:a.roundInfo,cardsPerRound:a.cardsPerRound});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadRoundBids",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.state.api.getBids(t,a);case 2:n=e.sent,console.log("Loaded bid history:"),console.log(n),this.setState({bidHistory:n.bidHistory});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"loadPlayingPhaseInfo",value:function(){var e=Object(d.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading playing phase info for game ".concat(t," and round ").concat(a)),e.next=3,this.state.api.getPlayingPhaseInfo(t,a);case 3:n=e.sent,console.log(n),this.setState({playingPhaseInfo:n});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onSelectGame",value:function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadGameInfo(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSelectRound",value:function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({round:t});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadGames",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state.api.adminGetGames().then((function(e){t.setState({games:e.games})})).catch((function(e){console.error(e),t.setState({errorMsg:e})}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadData",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("loading all data..."),this.loadGames(),t=new URL(window.location.href),a=this.state.gameId,t.searchParams.has("game")&&(a=t.searchParams.get("game")),a&&this.loadGameInfo(a),n=this.state.round,t.searchParams.has("round")&&(n=Number.parseInt(t.searchParams.get("round")||"-1",10)),a&&-1!==n&&(this.loadRoundBids(a,n),this.loadPlayingPhaseInfo(a,n)),this.setState({gameId:a,round:n}),window.setTimeout(this.loadData,8e3);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.loadData()}},{key:"render",value:function(){var e=null;return e=this.state.gameId?this.state.gameInfo?-1===this.state.round?l.a.createElement(Ae,{gameId:this.state.gameId,playerNames:this.state.playerNames,gameInfo:this.state.gameInfo,rounds:this.state.rounds,onSelectRound:this.onSelectRound}):l.a.createElement(Me,{gameId:this.state.gameId,playerNames:this.state.playerNames,gameInfo:this.state.gameInfo,round:this.state.round,roundInfo:this.state.roundInfo[this.state.round],cards:this.state.cardsPerRound[this.state.round],bidHistory:this.state.bidHistory,playingPhaseInfo:this.state.playingPhaseInfo}):l.a.createElement("div",null,"loading game info..."):l.a.createElement(Re,{games:this.state.games,onSelectGame:this.onSelectGame}),l.a.createElement("main",{className:"container"},e)}}]),a}(l.a.PureComponent);a(41);var Je=["en"],Ye=function(e){var t=new URL(window.location.href).searchParams.get("lang");if(t&&!Je.includes(t))throw new Error("Language ".concat(t," is not yet supported"));var a=Object(s.useState)(t||"en"),n=Object(p.a)(a,2),r=n[0];n[1];return l.a.createElement("div",{className:"wrapper landing-view"},l.a.createElement(Se,{hash:window.location.hash,setNavHash:function(e){var t=new URL(window.location.href);t.hash=e,window.location.href=t.toString(),console.debug("[landing] hash is now ".concat(e)),window.location.reload()}}),l.a.createElement("div",{className:"hero"},l.a.createElement("h1",{className:"title-text"},"1000!")),l.a.createElement("main",null,l.a.createElement("h1",null,"Welcome to the Tysyacha Web App"),l.a.createElement("p",{className:"instructions"},"You can play the Russian card game Tysyacha here against sophisticated AI opponents. Enter your name below to begin."),l.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t=function(){for(var e="",t=0;t<6;t++){var a=ie(87,123);e+=a<97?(a-87).toString():String.fromCharCode(a)}return e}(),a=new URL(window.location.href);a.hash="#local-ai-game",a.searchParams.set("gameId",t.toString());var n=e.target.playerName.value;return a.searchParams.set("playerName",n),a.searchParams.set("lang",r),window.location.href=a.toString(),!1}},l.a.createElement("label",{htmlFor:"name"},"Your Name"),l.a.createElement("input",{type:"text",className:"form-control",name:"playerName",placeholder:"enter your name to continue"}),l.a.createElement("button",{type:"submit",className:"btn btn-lg btn-primary form-control"},"Play"))),l.a.createElement("footer",null,"Created by Daniel Kats in 2021"))},Ve=(a(42),function(e){var t=k().map((function(e){return l.a.createElement("tr",{key:e.valueOf()},l.a.createElement("td",null,e.toString()),l.a.createElement("td",null,w(e)))})),a=N().map((function(e){return l.a.createElement("tr",{key:e.valueOf()},l.a.createElement("td",null,C(e)),l.a.createElement("td",null,e.valueOf()))}));return l.a.createElement("div",{className:"rules-view"},l.a.createElement("h1",null,"Rules"),l.a.createElement("section",null,l.a.createElement("h2",null,"About"),l.a.createElement("p",null,"Tysyacha is a card game of Russian origin played with 3 players. The object of the game is to accumulate 1000 points before your opponents."),l.a.createElement("p",null,"The game is played by bidding on a contract, to be comleted with hidden cards (called ",l.a.createElement("em",null,"treasure"),"). It is most similar to card games such as Bridge (in the sense there is a contract) and Poker (in the sense it involves bluffing and relying on hidden cards).")),l.a.createElement("section",null,l.a.createElement("h2",null,"Flow"),l.a.createElement("p",null,"Each game consists of multiple rounds, as many as it takes for a player to reach 1000 points. In each round, a different player deals. At the beginning of the game, a random player is assigned the dealer role, which then moves clockwise at the conclusion of each round."),l.a.createElement("p",null,"Each round consists of two phases: bidding, followed by the playing phase, which involes taking ",l.a.createElement("em",null,"tricks"),". During bidding, the players complete for the right to take the hidden ",l.a.createElement("em",null,"treasure")," cards. However, the player who won the bidding now holds a ",l.a.createElement("em",null,"contract")," for that point value. If they do not fulfill their contract, they will be penalized.")),l.a.createElement("section",null,l.a.createElement("h2",null,"Dealing"),l.a.createElement("p",null,"Each player is dealt 7 cards from a deck of 24 cards (9 through Ace), and the remaining 3 cards are placed in the middle face-down. These cards are called the ",l.a.createElement("em",null,"treasure"),", and are awarded to whichever player wins the contract.")),l.a.createElement("section",null,l.a.createElement("h2",null,"Bidding"),l.a.createElement("p",null,"Each player, starting with the player to the left of the dealer, may place a bid. This bid is the total point value they promise to take in the playing phase, summed over all the cards they win in each trick. The minimum bid is ",60," points and the bidding must increase in multiples of 5. At the end of the bidding phase, the player with the highest bid holds the contract for that point value. Any player may pass at any time (declining to make a bid), however once they pass they may ",l.a.createElement("strong",null,"not")," re-enter the bidding (in contrast to Bridge)."),l.a.createElement("div",{className:"alert alert-info",role:"alert"},l.a.createElement("strong",null,"Note\xa0"),"Any player can bid for any reason. They may bluff in order to force the bidding to go higher, or gamble on the treasure containing good cards."),l.a.createElement("p",null,"The bidding ends when either (a) all three players pass, or (b) one player makes a bid and the other two players pass. If all three players pass, the cards are re-dealt by the same dealer and the round is re-played."),l.a.createElement("p",null,"If a player holds a contract at the end of the bidding phase, the three ",l.a.createElement("em",null,"treasure")," cards are flipped face up for all players to view. Then the contract player takes those cards into their hand. They may at this point revise their contract up (never down), or choose to keep their existing contract."),l.a.createElement("p",null,"Finally, the contract player gives one card of their choosing from their hand, face down, to each opponent. This card may have been part of the treasure, or may be from their original hand. These cards are kept secret; players may not share what cards they have or what they received."),l.a.createElement("h3",null,"Contract"),l.a.createElement("p",null,"The player who wins the bidding phase is the ",l.a.createElement("em",null,"contract player"),". The winning bid is called the ",l.a.createElement("em",null,"contract"),". If the contract player fulfills their contract at the end of the playing phase, they will get the number of points in their contract. If the contract player fails to meet their contract, they will be deducted that number of points. Therefore, holding a contract for a large number of points is both lucrative and perilous."),l.a.createElement("p",null,"The other two players who do not hold the contract will receive as many points as they make during the playing phase (meaning they can never receive negative points).")),l.a.createElement("section",null,l.a.createElement("h2",null,"Point Values and Marriages"),l.a.createElement("p",null,"The central mechanic of Tysyacha is the ",l.a.createElement("em",null,"marriage"),". A player has a ",l.a.createElement("em",null,"marriage")," if they hold a King and Queen of the same suit. That marriage can be declared during the playing phase, awarding that player a large number of points. Declaring a marriage also makes that suit the ",l.a.createElement("em",null,"trump")," suit. The various marriage point values can be found in the table below."),l.a.createElement("table",{className:"table table-striped table-sm"},l.a.createElement("caption",null,"Table 1: marriage value table"),l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Suit"),l.a.createElement("th",null,"Points"))),l.a.createElement("tbody",null,t)),l.a.createElement("p",null,"The precedence of the various cards is different in Tysyacha from most card games. In the table below, the cards are listed in order of precedence (higher is more powerful) along with their point values."),l.a.createElement("table",{className:"table table-striped table-sm"},l.a.createElement("caption",null,"Table 2: card value table"),l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Card"),l.a.createElement("th",null,"Value"))),l.a.createElement("tbody",null,a))),l.a.createElement("section",null,l.a.createElement("h2",null,"Playing Phase - Taking Tricks"),l.a.createElement("p",null,"Once the bidding phase is complete and the cards are distributed, each player should have 8 cards. The contract player begins the playing phase."),l.a.createElement("p",null,'A trick consists of a single card from each player, played in clockwise order. The player with the "winning" card wins the trick and claims the points inside.'),l.a.createElement("h3",null,"Starting a Trick"),l.a.createElement("p",null,"The first player in a trick may play any card from their hand."),l.a.createElement("h3",null,"Playing Subsequent Cards in a Trick"),l.a.createElement("p",null,"Subsequent players must play a card of the same suit as the first card in the trick (",l.a.createElement("em",null,"leading suit"),"). If they do not have that suit, they ",l.a.createElement("strong",null,"must")," play a card from the trump suit (unlike Bridge where it is optional). If they do not have a card of the trump suit, or there is no trump, they may play any other card."),l.a.createElement("h3",null,"Who Wins the Trick?"),l.a.createElement("p",null,"If there is a trump suit, the highest trump card wins the trick (see table 2 for precedence). If no trump has been played (or there is no trump suit), the highest card played in the suit of the first card (",l.a.createElement("em",null,"leading suit"),") wins the trick. Therefore, all cards of suits other than the trump suit and leading suit may not win tricks. The winner of the trick has won the right to go next (start the next trick)."),l.a.createElement("h3",null,"Declaring Marriages"),l.a.createElement("p",null,'During playing, a player may declare a marriage on their turn, after they have won at least one trick. To do so, a player plays a king or queen of the suit in which they hold the marriage and declare "marriage" publicly. That suit now becomes the trump.'),l.a.createElement("div",{className:"alert alert-info",role:"alert"},l.a.createElement("strong",null,"Note\xa0"),"The contract player may not declare a marriage on their first turn, since winning a trick is necessary first."),l.a.createElement("p",null,"More than one marriage may be declared per game, by any player. The trump changes immediately after the marriage declaration, voiding the previous trump suit."),l.a.createElement("div",{className:"alert alert-warning",role:"alert"},l.a.createElement("strong",null,"Warning\xa0"),"Contract players should be careful when giving away queens and kings to other players at the end of bidding, as that may give those players a card they need for a marriage, possibly ruining your plans."),l.a.createElement("p",null,"While no marriages are declared, there is no trump suit. There is no trump suit at the beginning of play."),l.a.createElement("h3",null,"End of the Playing Phase - Scoring"),l.a.createElement("p",null,"Once all 8 tricks have been taken, players count the number of points contained in each trick they have taken and sum them. To this total, they add the point value of any marriages that they declared (see Table 1). Point totals are rounded to the nearest multiple of 5 (e.g. 12 is rounded down to 10 but 73 is rounded up to 75)."),l.a.createElement("p",null,"If the contract player has fulfilled their contract (obtained the number of points of their contract or more), they receive the number of points in their contract. They do not receive the excess points. If the contract player failed to meet their contract, the full value of the contract is deducted from their point total, regardless of how close they came to fulfilling the contract (e.g. if a player bid 140 points and obtained 135 points, they receive -140 points)."),l.a.createElement("p",null,"All other players receive the points they have obtained, including all marriage points."),l.a.createElement("p",null,"No points are awarded for marriages that have not been declared.")),l.a.createElement("section",null,l.a.createElement("h2",null,"End of the Game"),l.a.createElement("p",null,"Hands are played until one player accumulates 1000 points."),l.a.createElement("h3",null,"Barrel"),l.a.createElement("p",null,"No player may have between 880 and 1000 points. If any player accumulates between 880 and 1000 points, their score is rounded down to 880. Any player who has 880 points is said to be ",l.a.createElement("em",null,"on the barrel"),". Once a player is on the barrel, they have 3 turns to get 120 points (or more) in a single turn and win the game. Any time a player on the barrel gets less than 120 points, those points are rounded down to 0. If the player on the barrel does not gain 120 points in 3 turns, they receive -120 points, and are thrown off the barrel. If a player on the barrel ever goes below 880 points, they are similarly off the barrel (for example they lose a contract)."),l.a.createElement("p",null,"If a player on the barrel fails to meet a contract on their third turn on the barrel, they receive the greater negative of the failed contract or -120. For example, if a player loses a contract for 80 points on their third turn on the barrel, they receive -120 points. However if that same player loses a contract for 140 points, they receive -140 points. If a player on the barrel completes a contract on their third turn on the barrel, but the value of the contract is less than 120 points, they receive -120 points anyway and receive no points for the contract."),l.a.createElement("p",null,"A player can win the game (accumulate 1000 points) even if they are not on the barrel. For example, a player with 860 points may win the game by completing a contract for 140 or more points."),l.a.createElement("p",null,"A player may win with more than 1000 points.")),l.a.createElement("section",null,l.a.createElement("h2",null,"Misc."),l.a.createElement("p",null,"If, after 3 deals, a contract is not established (all players pass), the dealing player receives -120 points and the dealer role is rotated clockwise."),l.a.createElement("p",null,"No player may bid more than 120 points unless they hold at least one marriage in their hand."),l.a.createElement("p",null,"The total number of points in the deck (without marriages) is 120.")),l.a.createElement("section",null,l.a.createElement("h2",null,"Glossary"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"[On The] Barrel")," - a player who accumulates 880 points. They have 3 turns to get 1000 points or they receive -120 points."),l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"Contract")," - the highest (winning) bid in the bidding phase. The contract player must achieve at least this number during the playing phase."),l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"Contract Player")," - the player with the highest bid during the bidding phase."),l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"Leading Suit")," - the suit of the first card in a trick. Players must play cards of the same suit if they can."),l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"Marriage")," - a king and queen of the same suit. It may be declared during the playing phase to receive a large number of bonus points."),l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"Treasure")," - the three face-down secret cards dealt at the beginning of the game."),l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"Trick")," - one card from each player, played in clockwise order, during the playing phase."),l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"Trump Card")," - any card in the current trump suit."),l.a.createElement("li",null,l.a.createElement("strong",{className:"glossary-term"},"Trump [Suit]")," - a suit more powerful than the other suits, which must be played if a player does not have a card of the leading suit. A trump suit is declared through a marriage."))))});switch(console.debug("hash: ".concat(window.location.hash)),window.location.hash){case"":case"#":case"#landing":document.title="Tysyacha",o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(Ye,null)),document.getElementById("root"));break;case"#lounge":o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(se,null)),document.getElementById("root"));break;case"#rules":var We=new URL(window.location.href).searchParams.get("gameId")||null;o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement("div",{className:"wrapper"},l.a.createElement("header",null,l.a.createElement(Se,{gameId:We,hash:window.location.hash})),l.a.createElement("main",{className:"container"},l.a.createElement(Ve,null)))),document.getElementById("root"));break;case"#local-ai-game":case"#scorecard":var Ke=new URL(window.location.href),ze=Ke.searchParams.get("gameId"),Qe=Ke.searchParams.get("playerName");if(!ze||!Qe){window.location.href="/";break}document.title="Tysyacha | Game ".concat(ze),o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(Pe,{gameId:ze,playerName:Qe})),document.getElementById("root"));break;case"#server":o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(Fe,null)),document.getElementById("root"));break;case"#game":o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(te,null)),document.getElementById("root"));break;default:o.a.render(l.a.createElement("p",null,"Unknown hash - ",window.location.hash),document.getElementById("root"))}}},[[21,1,2]]]);
//# sourceMappingURL=main.304ef699.chunk.js.map